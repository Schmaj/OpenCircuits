!function t(e,s,i){function r(n,a){if(!s[n]){if(!e[n]){var h="function"==typeof require&&require;if(!a&&h)return h(n,!0);if(o)return o(n,!0);throw new Error("Cannot find module '"+n+"'")}var c=s[n]={exports:{}};e[n][0].call(c.exports,function(t){var s=e[n][1][t];return r(s||t)},c,c.exports,t,e,s,i)}return s[n].exports}for(var o="function"==typeof require&&require,n=0;n<i.length;n++)r(i[n]);return r}({1:[function(t,e,s){var i,r,o=(i=document.getElementById("save-button"),r=document.getElementById("project-name"),i.onclick=(()=>{o.saveFile()}),{ROOT:void 0,saveFile:function(){var t=this.write(getCurrentContext()),e=r.value;"Untitled Circuit*"===e&&(e="Untitled Circuit");var s=e+".circuit",i=new Blob([t],{type:"text/plain"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(i,s),saved=!0;else{var o=document.createElement("a"),n=URL.createObjectURL(i);o.href=n,o.download=s,document.body.appendChild(o),o.click(),setTimeout(function(){document.body.removeChild(o),window.URL.revokeObjectURL(n),saved=!0},0)}},write:function(t){var e=(new window.DOMParser).parseFromString('<?xml version="1.0" encoding="UTF-8"?><project></project>',"text/xml");this.ROOT=e;var s=t.getObjects(),i=t.getWires(),r=getChildNode(e,"project"),o=n(r,"ics");return this.writeICs(o),this.writeGroup(r,s,i),e.xml?e.xml:(new XMLSerializer).serializeToString(e)},writeGroup:function(t,e,s){for(var i=n(t,"objects"),r=n(t,"wires"),o=0;o<e.length;o++)e[o].writeTo(i);for(o=0;o<s.length;o++)s[o].writeTo(r)},writeICs:function(t){for(var e=0;e<h.ICs.length;e++){var s=h.ICs[e],i=n(t,"ic");a(i,"icuid",s.icuid),a(i,"width",s.transform.size.x),a(i,"height",s.transform.size.y);for(var r=n(i,"iports"),o=0;o<s.iports.length;o++)s.iports[o].writeTo(r);var l=n(i,"oports");for(o=0;o<s.oports.length;o++)s.oports[o].writeTo(l);var u=n(i,"components"),d=s.inputs.concat(s.components,s.outputs),p=c(d);this.writeGroup(u,d,p)}}});function n(t,e){var s=o.ROOT.createElement(e);return t.appendChild(s),s}function a(t,e,s){var i=o.ROOT.createElement(e),r=o.ROOT.createTextNode(s);i.appendChild(r),t.appendChild(i)}e.exports=o,e.exports.createChildNode=n,e.exports.createTextElement=a;var h=t("../models/ioobjects/other/ICData"),c=t("../libraries/ObjectUtils").GetAllWires},{"../libraries/ObjectUtils":35,"../models/ioobjects/other/ICData":76}],2:[function(t,e,s){var i=t("../libraries/Context"),r=function(){var t,e,s=document.getElementById("designer-canvas"),f=document.getElementById("ic-confirmbutton"),x=document.getElementById("ic-cancelbutton");f.onclick=(()=>{r.confirm()}),x.onclick=(()=>{r.cancel()});return{context:void 0,hidden:!0,setup:function(){t=new u(s,.84,.76),this.context=new i(t)},confirm:function(){if(void 0!=e){c.add(this.data);var t=this.ic.copy();t.setContext(context),m().getDesigner().addObject(t),this.hide()}},cancel:function(){void 0!=e&&this.hide()},show:function(t){i.setCurrentContext(this.context),this.hidden=!1,this.canvas.style.visibility="visible",this.confirmButton.style.visibility="visible",this.cancelButton.style.visibility="visible",popup.hide(),this.data=c.create(t),this.ic=new l(this.context,this.data,0,0),this.designer.addObject(this.ic),h.deselect(t),this.context.getCamera().zoom=.5+.1*(this.ic.transform.size.x-50)/20,v()},hide(){g(m()),this.hidden=!0,s.style.visibility="hidden",f.style.visibility="hidden",x.style.visibility="hidden",void 0!=e&&(e.remove(),e=void 0,void 0)},onMouseDown(){if(void 0==this.ic)return!1;for(var t=a.getWorldMousePos(),e=this.ic.inputs,s=0;s<e.length;s++){if(e[s].sContains(t))return this.drag=!0,this.dragObj=this.data.iports[s],!1}var i=this.ic.outputs;for(s=0;s<i.length;s++){if(i[s].sContains(t))return this.drag=!0,this.dragObj=this.data.oports[s],!1}var r=this.ic.getPos(),o=this.ic.getSize(),h=new n(r,o.scale(1.1),0,this.context.getCamera()),c=new n(r,o.scale(.9),0,this.context.getCamera());d(h,t)&&!d(c,t)&&(t.y<r.y+o.y/2-4&&t.y>r.y-o.y/2+4?this.dragEdge="horizontal":this.dragEdge="vertical")},onMouseUp(){if(void 0==this.ic)return!1;this.drag=!1,this.dragObj=void 0,this.dragEdge=void 0},onMouseMove(){if(void 0==this.ic)return!1;var t=a.getWorldMousePos();if(this.drag){var e=this.ic.getSize(),s=p(o(-e.x/2,-e.y/2),o(e.x/2,e.y/2),t),i=s.sub(t).normalize().scale(e.scale(.5)).add(s),r=s.sub(t).normalize().scale(e.scale(.5).sub(o(IO_PORT_LENGTH+e.x/2-25,IO_PORT_LENGTH+e.y/2-25))).add(s);return this.dragObj.setOrigin(i),this.dragObj.setTarget(r),this.ic.update(),!0}return void 0!=this.dragEdge?("horizontal"===this.dragEdge?this.data.transform.setWidth(Math.abs(2*t.x)):this.data.transform.setHeight(Math.abs(2*t.y)),this.data.recalculatePorts(),this.ic.update(),!0):void 0},onClick(){}}}();e.exports=r;var o=t("../libraries/math/Vector").V,n=t("../libraries/math/Transform"),a=(i=t("../libraries/Context"),t("./Input")),h=t("./tools/SelectionTool"),c=t("../models/ioobjects/other/ICData"),l=t("../models/ioobjects/other/IC"),u=t("../views/CircuitDesigner"),d=t("../libraries/math/MathUtils").RectContains,p=t("../libraries/math/MathUtils").GetNearestPointOnRect,g=t("../libraries/Context").setCurrentContext,m=(t("../libraries/Context").getCurrentContext,t("../libraries/Context").getMainContext),v=t("../views/Renderer").render},{"../libraries/Context":30,"../libraries/math/MathUtils":48,"../libraries/math/Transform":50,"../libraries/math/Vector":51,"../models/ioobjects/other/IC":75,"../models/ioobjects/other/ICData":76,"../views/CircuitDesigner":81,"../views/Renderer":82,"./Input":3,"./tools/SelectionTool":25}],3:[function(t,e,s){var i=t("../libraries/Constants").LEFT_MOUSE_BUTTON,r=t("../libraries/Constants").SHIFT_KEY,o=t("../libraries/Constants").CONTROL_KEY,n=t("../libraries/Constants").COMMAND_KEY,a=t("../libraries/Constants").OPTION_KEY,h=t("../libraries/Constants").ENTER_KEY,c=(t("../libraries/Utils").GetBrowser(),t("../libraries/math/Vector")),l=t("../libraries/math/Vector").V,u=function(){var t=new c(0,0),e=new c(0,0),s=new c(0,0),u=new c(0,0),b=!1,y=void 0,C=[],I=!1,w=!1,O=!1,T=!1,M=void 0;console.log(I);var S=function(i){var r=v().getRenderer().canvas,o=v().getCamera(),n=r.getBoundingClientRect();s.x=e.x,s.y=e.y,t=new c(i.clientX,i.clientY),e=new c(i.clientX-n.left,i.clientY-n.top),u=o.getWorldPos(e),T=b&&Date.now()-M>50;var a=!1;if(O&&T){var h=new c(e.x,e.y),l=y.sub(h);o.translate(o.zoom*l.x,o.zoom*l.y),y=e,g.onMove(),a=!0}a=f().onMouseMove(a)||a;for(var d=0;d<C.length;d++)a=C[d].onMouseMove(a)||a;a&&x()},P=function(t){b=!1;var e=!1;e=f().onMouseUp(e);for(var s=0;s<C.length;s++)e=C[s].onMouseUp(e)||e;e&&x()},D=function(t){var e=!1;e=f().onClick(e);for(var s=0;s<C.length;s++)e=C[s].onClick(e)||e;e&&x()};return window.addEventListener("keydown",t=>{!function(t){var e=t.keyCode;switch(console.log(I),e){case r:I=!0;break;case o:case n:w=!0;break;case a:O=!0,v().setCursor("pointer");break;case h:document.activeElement!==document.body&&document.activeElement.blur()}for(var s=v().getObjects(),i=0;i<s.length;i++)s[i]instanceof d&&s[i].onKeyDown(e);v().getHistoryManager().onKeyDown(e),f().onKeyDown(e)&&x()}(t)},!1),window.addEventListener("keyup",t=>{!function(t){var e=t.keyCode;switch(e){case r:I=!1;break;case o:case n:w=!1;break;case a:O=!1,v().setCursor("default")}for(var s=v().getObjects(),i=0;i<s.length;i++)s[i]instanceof d&&s[i].onKeyUp(e);f().onKeyUp(e)&&x()}(t)},!1),{registerContext:function(t){var s=t.getRenderer().canvas;s.addEventListener("click",t=>D(),!1),s.addEventListener("dblclick",t=>void 0,!1),s.addEventListener("wheel",t=>(function(t){var s=v().getCamera(),i=.95;-t.deltaY/120<0&&(i=1/i);var r=s.getWorldPos(e);s.zoomBy(i);var o=s.getScreenPos(r),n=(e.x-o.x)*s.zoom,a=(e.y-o.y)*s.zoom;s.translate(-n,-a),g.onWheel(),x()})(t),!1),s.addEventListener("mousedown",t=>(function(t){var e=v().getRenderer().canvas.getBoundingClientRect();if(T=!1,M=Date.now(),b=!0,y=new c(t.clientX-e.left,t.clientY-e.top),t.button===i){var s=!1;p.hide(),s=f().onMouseDown(s);for(var r=0;r<C.length;r++)s=C[r].onMouseDown(s)||s;s&&x()}})(t),!1),s.addEventListener("mouseup",t=>P(),!1),s.addEventListener("mousemove",t=>S(t),!1),s.addEventListener("mouseenter",t=>{m.drag&&(S(t),D(),m.drag=!1)},!1),s.addEventListener("mouseleave",t=>{b&&(P(),D())}),s.addEventListener("contextmenu",function(t){p.show(t),t.preventDefault()})},addMouseListener:function(t){C.push(t)},getWorldMousePos:()=>l(u),getRawMousePos:()=>l(t),getShiftKeyDown:()=>I,getModifierKeyDown:()=>w,getOptionKeyDown:()=>O,isDragging:()=>T}}();e.exports=u;var d=t("../models/ioobjects/inputs/Keyboard"),p=t("./contextmenu/ContextMenu"),g=t("./selectionpopup/SelectionPopup"),m=t("./PlaceItemController"),v=t("../libraries/Context").getCurrentContext,f=t("./tools/Tool").getCurrent,x=t("../views/Renderer").render},{"../libraries/Constants":29,"../libraries/Context":30,"../libraries/Utils":38,"../libraries/math/Vector":51,"../models/ioobjects/inputs/Keyboard":70,"../views/Renderer":82,"./PlaceItemController":5,"./contextmenu/ContextMenu":9,"./selectionpopup/SelectionPopup":22,"./tools/Tool":26}],4:[function(t,e,s){var i=t("../libraries/Constants").ITEMNAV_WIDTH,r=function(){var t=document.getElementById("open-items-tab"),e=document.getElementById("items");t.onclick=(()=>{r.toggle()});return{isOpen:!1,toggle:function(){this.isOpen?(this.isOpen=!1,e.style.width="0px",t.style.marginLeft=r.getTabOffset()+"px",t.style.borderColor="rgba(153, 153, 153, 0.7)",t.style.backgroundColor="rgba(200, 200, 200, 0.7)",t.style.fontSize="2em",t.innerHTML="&#9776;"):(this.isOpen=!0,e.style.width=i+"px",t.style.marginLeft=r.getTabOffset()+"px",t.style.borderColor="rgba(153, 153, 153, 0.0)",t.style.backgroundColor="rgba(200, 200, 200, 0.0)",t.style.fontSize="2.5em",t.innerHTML="&times;")},getTabOffset:function(){return this.isOpen?i-t.offsetWidth:0}}}();e.exports=r},{"../libraries/Constants":29}],5:[function(t,e,s){var i=t("../models/ioobjects/outputs/7SegmentDisplay"),r=t("../models/ioobjects/inputs/ConstantLow"),o=t("../models/ioobjects/inputs/ConstantHigh"),n=t("../models/ioobjects/inputs/Button"),a=t("../models/ioobjects/inputs/Switch"),h=t("../models/ioobjects/inputs/Clock"),c=t("../models/ioobjects/inputs/Keyboard"),l=t("../models/ioobjects/outputs/LED"),u=t("../models/ioobjects/gates/BUFGate"),d=t("../models/ioobjects/gates/ANDGate"),p=t("../models/ioobjects/gates/ORGate"),g=t("../models/ioobjects/gates/XORGate"),m=t("../models/ioobjects/flipflops/SRFlipFlop"),v=t("../models/ioobjects/other/Multiplexer"),f=t("../models/ioobjects/other/Demultiplexer"),x=t("../models/ioobjects/other/Encoder"),b=t("../models/ioobjects/other/Decoder"),y=t("../models/ioobjects/other/Label"),C=function(){function t(t,e,s){var i=document.getElementById(t+"-button"),r=document.getElementById(t+"-image");i.onclick=(()=>{C.place(new e,s)}),r.ondragend=(t=>{C.onDragEnd(t)})}return t("constantlow",r),t("constanthigh",o),t("button",n),t("switch",a),t("clock",h),t("keyboard",c),t("led",l),t("7segmentdisplay",i),t("bufgate",u),t("andgate",d),t("orgate",p),t("xorgate",g),t("notgate",u,!0),t("nandgate",d,!0),t("norgate",p,!0),t("xnorgate",g,!0),t("srflipflop",m),t("multiplexer",v),t("demultiplexer",f),t("encoder",x),t("decoder",b),t("label",y),{drag:!1,place:function(t,e){e&&(t.not=e);w().getRenderer().canvas.getBoundingClientRect();I.activate(t,w())},onDragEnd:function(t){this.drag=!0,t.srcElement.parentElement.onclick()}}}(),I=t("./tools/ItemTool"),w=t("../libraries/Context").getCurrentContext},{"../libraries/Context":30,"../models/ioobjects/flipflops/SRFlipFlop":61,"../models/ioobjects/gates/ANDGate":62,"../models/ioobjects/gates/BUFGate":63,"../models/ioobjects/gates/ORGate":64,"../models/ioobjects/gates/XORGate":65,"../models/ioobjects/inputs/Button":66,"../models/ioobjects/inputs/Clock":67,"../models/ioobjects/inputs/ConstantHigh":68,"../models/ioobjects/inputs/ConstantLow":69,"../models/ioobjects/inputs/Keyboard":70,"../models/ioobjects/inputs/Switch":71,"../models/ioobjects/other/Decoder":72,"../models/ioobjects/other/Demultiplexer":73,"../models/ioobjects/other/Encoder":74,"../models/ioobjects/other/Label":77,"../models/ioobjects/other/Multiplexer":78,"../models/ioobjects/outputs/7SegmentDisplay":79,"../models/ioobjects/outputs/LED":80,"./tools/ItemTool":24}],6:[function(t,e,s){var i,r,o=(i=void 0,r=void 0,{onMouseDown:function(t){var e=p().getObjects(),s=p().getWires(),r=h.getWorldMousePos();if(!t&&c.isActive&&!h.getOptionKeyDown()){for(var o=0;o<e.length;o++){var a=e[o];if(a.contains(r)||a.sContains(r)||-1!==a.oPortContains(r)||-1!==a.iPortContains(r))return}for(o=0;o<s.length;o++)if(-1!==s[o].getNearestT(r.x,r.y))return;i=n(r),l.hide()}},onMouseMove:function(){p().getObjects();var t=h.getWorldMousePos();if(void 0!=i)return r=n(t),l.hide(),!0},onMouseUp:function(){},onClick:function(t){p().getObjects();var e=h.getWorldMousePos();if(void 0!=i){r=n(e);var s=function(){var t=p().getObjects(),e=[];if(void 0!=i)for(var s=new a(n((i.x+r.x)/2,(i.y+r.y)/2),n(Math.abs(r.x-i.x),Math.abs(r.y-i.y)),0,p().getCamera()),o=0;o<t.length;o++){var h=t[o],c=void 0!=h.selectionBoxTransform?h.selectionBoxTransform:h.transform;if(d(c,s))e.push(h);else if(void 0!=h.inputs&&void 0!=h.outputs){for(var l=0;l<h.inputs.length;l++){var g=h.inputs[l];u(s,g.getPos())&&e.push(g)}for(l=0;l<h.outputs.length;l++){var m=h.outputs[l];u(s,m.getPos())&&e.push(m)}}}return e}();return h.getShiftKeyDown()||c.deselectAll(!0),c.select(s,!0),i=void 0,r=void 0,!0}},draw(t){var e=t.getCamera();if(void 0!=i&&void 0!=r){var s=e.getScreenPos(i),o=e.getScreenPos(r),n=o.x-s.x,a=o.y-s.y;t.save(),t.context.globalAlpha=.4,t.rect(s.x+n/2,s.y+a/2,n,a,"#ffffff","#6666ff",2/e.zoom),t.restore()}}});e.exports=o;t("../libraries/math/Vector");var n=t("../libraries/math/Vector").V,a=t("../libraries/math/Transform"),h=t("./Input"),c=t("./tools/SelectionTool"),l=t("./selectionpopup/SelectionPopup"),u=t("../libraries/math/MathUtils").RectContains,d=t("../libraries/math/MathUtils").TransformContains,p=t("../libraries/Context").getCurrentContext},{"../libraries/Context":30,"../libraries/math/MathUtils":48,"../libraries/math/Transform":50,"../libraries/math/Vector":51,"./Input":3,"./selectionpopup/SelectionPopup":22,"./tools/SelectionTool":25}],7:[function(t,e,s){var i,r,o,n,a,h,c,l,u,d,p=t("../libraries/Constants").GRID_SIZE,g=t("../libraries/Constants").ROTATION_CIRCLE_R2,m=t("../libraries/Constants").ROTATION_CIRCLE_R1,v=t("../libraries/Constants").ROTATION_CIRCLE_RADIUS,f=t("../libraries/math/Vector").V,x=(i=void 0,r=!1,o=!1,n=f(0,0),a=[],h=0,c=0,l=[],u=[],d=[],{startDrag:function(t,e){t.selected||(C.deselectAll(),C.select([t])),a=C.selections,d=[];for(var s=0;s<a.length;s++){if(!a[s].transform)return!0;d[s]=a[s].transform.copy()}return r=!0,n=e.copy().sub(t.getPos()),i=t,I.hide(),!0},startRotation(t,e){u=t,l=[],d=[];for(var s=0;s<u.length;s++){if(!u[s].transform)return!0;l[s]=u[s].getAngle(),d[s]=u[s].transform.copy()}return o=!0,h=Math.atan2(e.y-C.midpoint.y,e.x-C.midpoint.x),c=h,I.hide(),!0},onMouseDown:function(){var t=T().getObjects(),e=y.getWorldMousePos();if(!o&&C.selections.length>0){var s=e.sub(C.midpoint).len2();if(s<=g&&s>=m)return this.startRotation(C.selections,e)}for(var r=t.length-1;r>=0;r--){var n=t[r];if(n.contains(e)||n.sContains(e))return void(i=n)}},onMouseMove:function(){T().getObjects();var t=y.getWorldMousePos();return r||void 0==i?r?(function(t,e){for(var s=f(t).sub(i.getPos()).sub(n),r=0;r<a.length;r++){var o=a[r],h=o.getPos().add(s);e&&(h=f(Math.floor(h.x/p+.5)*p,Math.floor(h.y/p+.5)*p)),o.setPos(h)}C.recalculateMidpoint()}(t,y.getShiftKeyDown()),!0):o?(function(t,e){for(var s=C.midpoint,i=Math.atan2(t.y-s.y,t.x-s.x)-c,r=0;r<u.length;r++){var o=l[r]+i;l[r]=o,e&&(o=Math.floor(o/(Math.PI/4))*Math.PI/4),u[r].setRotationAbout(o,s)}c=i+c}(t,y.getShiftKeyDown()),!0):void 0:this.startDrag(i,t)},onMouseUp:function(){return i=void 0,r?(T().addAction(b(a,d)),r=!1,!0):o?(T().addAction(b(u,d)),o=!1,!0):void 0},onClick:function(){},draw:function(t){var e=t.getCamera(),s=e.getScreenPos(C.midpoint),i=v/e.zoom;if(o){t.save(),t.context.fillStyle="#fff",t.context.strokeStyle="#000",t.context.lineWidth=5,t.context.globalAlpha=.4,t.context.beginPath(),t.context.moveTo(s.x,s.y);var r=(c-h)%(2*Math.PI);r<0&&(r+=2*Math.PI),t.context.arc(s.x,s.y,i,h,c,r>Math.PI),t.context.fill(),t.context.closePath(),t.restore()}}});function b(t,e){for(var s=new w,i=0;i<t.length;i++){var r=e[i],o=t[i].transform.copy();r.equals(o)||s.add(new O(t[i],r,o))}return s}e.exports=x;var y=t("./Input"),C=t("./tools/SelectionTool"),I=t("./selectionpopup/SelectionPopup"),w=t("../libraries/actions/GroupAction"),O=t("../libraries/actions/TransformAction"),T=t("../libraries/Context").getCurrentContext},{"../libraries/Constants":29,"../libraries/Context":30,"../libraries/actions/GroupAction":41,"../libraries/actions/TransformAction":46,"../libraries/math/Vector":51,"./Input":3,"./selectionpopup/SelectionPopup":22,"./tools/SelectionTool":25}],8:[function(t,e,s){var i,r,o,n=(i=void 0,r=void 0,o=-1,{onMouseDown:function(t){var e=d().getObjects(),s=d().getWires(),n=h.getWorldMousePos();if(!t){for(var a=e.length-1;a>=0;a--){var c,l=e[a];if(-1!==(c=l.oPortContains(n)))return void(i=l.outputs[c]);if(-1!==(c=l.iPortContains(n)))return void(i=l.inputs[c])}for(a=0;a<s.length;a++){var u,p=s[a];if(-1!==(u=p.getNearestT(n.x,n.y)))return r=p,o=u,!0}}},onMouseMove:function(t){var e=h.getWorldMousePos();if(!t){if(void 0!=i)return u.activate(i,d()),i=void 0,!0;if(void 0!=r){r.split(o);var s=new a(r);return d().addAction(s),l.deselectAll(),l.select([r.connection]),c.startDrag(r.connection,e),r=void 0,!0}}},onMouseUp:function(){},onClick:function(t){return t?(i=void 0,void(r=void 0)):void 0!=i?(u.activate(i,d()),i=void 0,!0):void 0!=r?(h.getShiftKeyDown()||l.deselectAll(!0),l.select([r],!0),r=void 0,!0):void 0}});e.exports=n;t("../libraries/math/Vector").V;var a=t("../libraries/actions/SplitWireAction"),h=t("./Input"),c=t("./TransformController"),l=t("./tools/SelectionTool"),u=t("./tools/WiringTool"),d=(t("./selectionpopup/SelectionPopup"),t("../libraries/Context").getCurrentContext)},{"../libraries/Context":30,"../libraries/actions/SplitWireAction":45,"../libraries/math/Vector":51,"./Input":3,"./TransformController":7,"./selectionpopup/SelectionPopup":22,"./tools/SelectionTool":25,"./tools/WiringTool":27}],9:[function(t,e,s){var i=t("../../libraries/popup/Popup"),r=t("./CutModule"),o=t("./CopyModule"),n=t("./PasteModule"),a=t("./SelectAllModule"),h=t("./UndoModule"),c=t("./RedoModule");var l=new class extends i{constructor(){super("context-menu"),this.add(new r(this,"context-menu-cut")),this.add(new o(this,"context-menu-copy")),this.add(new n(this,"context-menu-paste")),this.add(new a(this,"context-menu-select-all")),this.add(new h(this,"context-menu-undo")),this.add(new c(this,"context-menu-redo"))}onKeyDown(t){t!==ESC_KEY||this.hidden||this.hide()}onShow(){super.onShow();var t=u.getRawMousePos();this.setPos(V(t.x,t.y))}};e.exports=l;var u=t("../Input")},{"../../libraries/popup/Popup":53,"../Input":3,"./CopyModule":10,"./CutModule":11,"./PasteModule":12,"./RedoModule":13,"./SelectAllModule":14,"./UndoModule":15}],10:[function(t,e,s){var i=t("../../libraries/popup/Module"),r=t("../tools/SelectionTool");e.exports=class extends i{constructor(t,e){super(t,e)}onShow(){this.setDisabled(0==r.selections.length)}onClick(){this.parent.hide(),document.execCommand("copy")}}},{"../../libraries/popup/Module":52,"../tools/SelectionTool":25}],11:[function(t,e,s){var i=t("../../libraries/popup/Module"),r=t("../tools/SelectionTool");e.exports=class extends i{constructor(t,e){super(t,e)}onShow(){this.setDisabled(0==r.selections.length)}onClick(){this.parent.hide(),document.execCommand("cut")}}},{"../../libraries/popup/Module":52,"../tools/SelectionTool":25}],12:[function(t,e,s){var i=t("../../libraries/popup/Module");e.exports=class extends i{constructor(t,e){super(t,e)}onShow(){this.setDisabled(!1)}onClick(){this.parent.hide(),document.execCommand("copy")}}},{"../../libraries/popup/Module":52}],13:[function(t,e,s){var i=t("../../libraries/popup/Module");e.exports=class extends i{constructor(t,e){super(t,e)}onShow(){this.setDisabled(0==getCurrentContext().designer.history.redoStack.length)}onClick(){this.parent.hide(),getCurrentContext().designer.history.redo()}}},{"../../libraries/popup/Module":52}],14:[function(t,e,s){var i=t("../../libraries/popup/Module"),r=t("../tools/SelectionTool"),o=t("../../views/Renderer").render;e.exports=class extends i{constructor(t,e){super(t,e)}onShow(){this.setDisabled(!1)}onClick(){this.parent.hide(),r.selectAll(),o()}}},{"../../libraries/popup/Module":52,"../../views/Renderer":82,"../tools/SelectionTool":25}],15:[function(t,e,s){var i=t("../../libraries/popup/Module");e.exports=class extends i{constructor(t,e){super(t,e)}onShow(){this.setDisabled(0==getCurrentContext().designer.history.undoStack.length)}onClick(){this.parent.hide(),getCurrentContext().designer.history.undo()}}},{"../../libraries/popup/Module":52}],16:[function(t,e,s){var i=t("../../libraries/popup/Module");e.exports=class extends i{constructor(t,e){super(t,e)}onShow(){for(var t=0,e=0,s=r.selections,i=0;i<s.length;i++)if(s[i]instanceof o)t++;else{if(!(s[i]instanceof n))return void this.setVisibility("none");e++}this.setVisibility(t===e?"inherit":"none")}onClick(){this.createBus()}createBus(){for(var t=r.selections,e=[],s=[],i=0;i<t.length;i++)t[i]instanceof o?e.push(t[i]):s.push(t[i]);for(;s.length>0;){var n=-1/0,c=-1,l=-1;for(i=0;i<s.length;i++){for(var u=s[i].getPos(),d=1/0,p=-1,g=0;g<e.length;g++){var m=e[g],v=u.sub(m.getPos()).len2();v<d&&(d=v,p=g)}d>n&&(n=d,c=i,l=p)}var f=new a(context);getCurrentContext().add(f),s[c].connect(f),f.connect(e[l]),f.set=!0,f.straight=!0,s.splice(c,1),e.splice(l,1)}h()}};var r=t("../tools/SelectionTool"),o=t("../../models/IPort"),n=t("../../models/OPort"),a=t("../../models/Wire"),h=t("../../views/Renderer").render},{"../../libraries/popup/Module":52,"../../models/IPort":56,"../../models/OPort":57,"../../models/Wire":58,"../../views/Renderer":82,"../tools/SelectionTool":25}],17:[function(t,e,s){var i=t("../../libraries/popup/Module");e.exports=class extends i{constructor(t,e,s){super(t,e,s)}onShow(){for(var t=!0,e=!0,s=r.selections,i=0;i<s.length;i++)(t=t&&s[i]instanceof o)&&(e=e&&s[i].color===s[0].color);this.setVisibility(t?"inherit":"none"),this.setValue(t&&e?s[0].color:"#ffffff")}onChange(){for(var t=r.selections,e=0;e<t.length;e++)t[e].color=this.getValue()}onFocus(){this.parent.focused=!0}onBlur(){this.parent.focused=!1,this.onChange()}};var r=t("../tools/SelectionTool"),o=t("../../models/ioobjects/outputs/LED")},{"../../libraries/popup/Module":52,"../../models/ioobjects/outputs/LED":80,"../tools/SelectionTool":25}],18:[function(t,e,s){var i=t("../../libraries/popup/Module");e.exports=class extends i{constructor(t,e){super(t,e)}onShow(){for(var t=0,e=a.selections,s=0;s<e.length;s++)e[s]instanceof r&&!(e[s]instanceof o)&&t++;this.setVisibility(t>=2?"inherit":"none")}onClick(){n.show(a.selections)}};var r=t("../../models/IOObject"),o=t("../../models/WirePort"),n=t("../ICDesigner"),a=t("../tools/SelectionTool")},{"../../libraries/popup/Module":52,"../../models/IOObject":54,"../../models/WirePort":59,"../ICDesigner":2,"../tools/SelectionTool":25}],19:[function(t,e,s){var i=t("../../libraries/popup/Module");e.exports=class extends i{constructor(t,e,s){super(t,e,s)}onShow(){for(var t=!0,e=!0,s=0,i=999,o=r.selections,n=0;n<o.length;n++)e=e&&o[n].maxInputs>1&&!0!==o[n].noChange,t=t&&o[n].getInputAmount()===o[0].getInputAmount(),s=Math.max(o[n].getMinInputFieldCount(),s),i=Math.min(o[n].getMaxInputFieldCount(),i);this.setValue(t?o[0].getInputAmount():""),this.setPlaceholder(t?"":"-"),this.setVisibility(e?"inherit":"none"),this.div.min=s,this.div.max=i}onChange(){for(var t=r.selections,e=0;e<t.length;e++)t[e].setInputAmount(Number(this.getValue()))}};var r=t("../tools/SelectionTool")},{"../../libraries/popup/Module":52,"../tools/SelectionTool":25}],20:[function(t,e,s){var i=t("../../libraries/Constants").GRID_SIZE,r=t("../../libraries/popup/Module");e.exports=class extends r{constructor(t,e){super(t,e)}onShow(){for(var t=!0,e=h.selections,s=0;s<e.length;s++)t=t&&e[s].getPos().x===e[0].getPos().x;this.setValue(t?+(e[0].getPos().x/i-.5).toFixed(3):""),this.setPlaceholder(t?"":"-")}onChange(){for(var t=new n,e=h.selections,s=0;s<e.length;s++){if(!e[s].transform)return void this.onShow();var r=e[s].transform.copy();e[s].setPos(o(i*(Number(this.getValue())+.5),e[s].transform.getPos().y));var l=e[s].transform.copy();t.add(new a(e[s],r,l))}c().addAction(t)}};var o=t("../../libraries/math/Vector").V,n=t("../../libraries/actions/GroupAction"),a=t("../../libraries/actions/TransformAction"),h=t("../tools/SelectionTool"),c=t("../../libraries/Context").getCurrentContext},{"../../libraries/Constants":29,"../../libraries/Context":30,"../../libraries/actions/GroupAction":41,"../../libraries/actions/TransformAction":46,"../../libraries/math/Vector":51,"../../libraries/popup/Module":52,"../tools/SelectionTool":25}],21:[function(t,e,s){var i=t("../../libraries/Constants").GRID_SIZE,r=t("../../libraries/popup/Module");e.exports=class extends r{constructor(t,e){super(t,e)}onShow(){for(var t=!0,e=h.selections,s=0;s<e.length;s++)t=t&&e[s].getPos().y===e[0].getPos().y;this.setValue(t?+(e[0].getPos().y/i-.5).toFixed(3):""),this.setPlaceholder(t?"":"-")}onChange(){for(var t=new n,e=h.selections,s=0;s<e.length;s++){if(!e[s].transform)return void this.onShow();var r=e[s].transform.copy();e[s].setPos(o(e[s].transform.getPos().x,i*(Number(this.getValue())+.5)));var l=e[s].transform.copy();t.add(new a(e[s],r,l))}c().addAction(t)}};var o=t("../../libraries/math/Vector").V,n=t("../../libraries/actions/GroupAction"),a=t("../../libraries/actions/TransformAction"),h=t("../tools/SelectionTool"),c=t("../../libraries/Context").getCurrentContext},{"../../libraries/Constants":29,"../../libraries/Context":30,"../../libraries/actions/GroupAction":41,"../../libraries/actions/TransformAction":46,"../../libraries/math/Vector":51,"../../libraries/popup/Module":52,"../tools/SelectionTool":25}],22:[function(t,e,s){var i=t("../../libraries/Constants").DELETE_KEY,r=t("../../libraries/Constants").ESC_KEY,o=t("../../libraries/popup/Popup"),n=t("./TitleModule"),a=t("./PositionXModule"),h=t("./PositionYModule"),c=t("./InputCountModule"),l=t("./ColorPickerModule"),u=t("./ICButtonModule"),d=t("./BusButtonModule");var p=new class extends o{constructor(){super("popup"),this.add(new n(this,"popup-name")),this.add(new a(this,"popup-position-x")),this.add(new h(this,"popup-position-y")),this.add(new c(this,"popup-input-count","popup-input-count-text")),this.add(new l(this,"popup-color-picker","popup-color-text")),this.add(new u(this,"popup-ic-button")),this.add(new d(this,"popup-bus-button"))}onKeyDown(t){if(t!==i||this.focused)return t!==r||this.hidden?void 0:(g.deselectAll(),void render());g.removeSelections(!0)}onEnter(){this.blur()}update(){g.selections.length>0?(this.show(),this.onMove()):this.hide()}onMove(){var t=m().getCamera();if(g.selections.length>0){g.recalculateMidpoint();var e=t.getScreenPos(g.midpoint);e.y-=this.div.clientHeight/2,this.setPos(e)}}onWheel(){this.onMove()}};e.exports=p;var g=t("../tools/SelectionTool"),m=t("../../libraries/Context").getCurrentContext},{"../../libraries/Constants":29,"../../libraries/Context":30,"../../libraries/popup/Popup":53,"../tools/SelectionTool":25,"./BusButtonModule":16,"./ColorPickerModule":17,"./ICButtonModule":18,"./InputCountModule":19,"./PositionXModule":20,"./PositionYModule":21,"./TitleModule":23}],23:[function(t,e,s){var i=t("../../libraries/popup/Module");e.exports=class extends i{constructor(t,e){super(t,e)}onShow(){for(var t=!0,e=r.selections,s=0;s<e.length;s++)t=t&&e[s].getName()===e[0].getName();this.setValue(t?e[0].getName():"<Multiple>")}onChange(){for(var t=r.selections,e=0;e<t.length;e++)t[e].setName(this.getValue())}onFocus(){this.parent.focused=!0}onBlur(){this.parent.focused=!1,this.onChange()}};var r=t("../tools/SelectionTool")},{"../../libraries/popup/Module":52,"../tools/SelectionTool":25}],24:[function(t,e,s){var i={isActive:!1,item:void 0,activate:function(t,e){void 0!=this.item&&e.remove(this.item),n.setCurrent(this),this.item=t,e.addObject(this.item),this.onMouseMove()},deactivate:function(){this.item=void 0},onKeyDown:function(){},onKeyUp:function(){},onMouseDown:function(){},onMouseMove:function(){return this.item.setPos(o.getWorldMousePos()),!0},onMouseUp:function(){},onClick:function(){this.item.setPos(o.getWorldMousePos());var t=new r(this.item);return h().addAction(t),a.activate(),!0},draw:function(){}};e.exports=i;var r=t("../../libraries/actions/PlaceAction"),o=t("../Input"),n=t("./Tool"),a=t("./SelectionTool"),h=t("../../libraries/Context").getCurrentContext},{"../../libraries/Context":30,"../../libraries/actions/PlaceAction":42,"../Input":3,"./SelectionTool":25,"./Tool":26}],25:[function(t,e,s){var i=t("../../libraries/Constants").A_KEY,r=t("../../libraries/Constants").ROTATION_CIRCLE_RADIUS,o=t("../../libraries/Constants").ROTATION_CIRCLE_THICKNESS,n=t("../../libraries/math/Vector").V,a={isActive:!1,selections:[],midpoint:n(0,0),activate:function(){f.setCurrent(this)},deactivate:function(){},onKeyDown:function(t,e){return console.log(t),!!p.hidden&&(t===i&&d.getModifierKeyDown()?(this.selectAll(),!0):void 0)},onKeyUp:function(){},onMouseDown:function(){var t=C().getObjects(),e=(C().getWires(),d.getWorldMousePos());if(!p.hidden)return!1;for(var s=t.length-1;s>=0;s--){var i=t[s];if(i.contains(e))return i.isPressable&&i.press(),!0;if(i.sContains(e))return;if(-1!==i.oPortContains(e)||-1!==i.iPortContains(e))return}},onMouseMove:function(){},onMouseUp:function(){var t=C().getObjects();if(C().getWires(),d.getWorldMousePos(),!p.hidden)return!1;v.update();for(var e=0;e<t.length;e++){var s=t[e];if(s.isPressable&&s.isOn&&!d.isDragging())return s.release(),!0}},onClick:function(){var t=C().getObjects(),e=(C().getWires(),d.getWorldMousePos());if(console.log("uppy"),console.log(t),console.log(p.hidden),console.log(d.isDragging()),!p.hidden||d.isDragging())return!1;for(var s=t.length-1;s>=0;s--){var i=t[s];if(i.sContains(e))return d.getShiftKeyDown()||this.deselectAll(!0),this.select([i],!0),!0;if(console.log(i),console.log(i.contains(e)),i.contains(e))return i.click(),!0}return!d.getShiftKeyDown()&&this.selections.length>0?(this.deselectAll(!0),!0):void 0},select:function(t,e){if(0!==t.length){for(var s=new l,i=0;i<t.length;i++){var r=t[i];r.selected||(r.selected=!0,this.selections.push(r),this.sendToFront(r),e&&s.add(new h(r)))}e&&C().addAction(s),v.update(),this.recalculateMidpoint()}},deselect:function(t,e){if(0!==t.length){for(var s=new l,i=0;i<t.length;i++){var r=t[i];r.selected?(r.selected=!1,this.selections.splice(this.selections.indexOf(r),1),e&&s.add(new h(r,!0))):console.error("Can't deselect an unselected object! "+r)}e&&C().addAction(s),v.update(),this.recalculateMidpoint()}},selectAll:function(){this.deselectAll(!0),this.select(C().getObjects(),!0)},deselectAll:function(t){for(var e=[],s=0;s<this.selections.length;s++)e.push(this.selections[s]);this.deselect(e,t)},sendToFront:function(t){(t instanceof x||t instanceof b)&&(C().remove(t),C().add(t))},recalculateMidpoint:function(){this.midpoint=n(0,0);for(var t=0;t<this.selections.length;t++)this.midpoint.translate(this.selections[t].getPos());this.midpoint=this.midpoint.scale(1/this.selections.length)},removeSelections(t){if(0!==this.selections.length){for(var e=new l,s=u(objects),i=0;i<s.length;i++)if(s[i].selected&&this.deselect([s[i]]),s[i]instanceof b||s[i]instanceof y){var r=s[i].input,o=s[i].connection;s[i].remove(),t&&e.add(new c(s[i],r,o))}for(i=0;i<s.length;i++)s[i]instanceof b||s[i]instanceof y||(s[i].remove(),t&&e.add(new c(s[i])));t&&C().addAction(e)}},draw:function(t){var e=t.getCamera();if(this.selections.length>0&&!this.drag){var s=e.getScreenPos(this.midpoint),i=r/e.zoom,n=o/e.zoom;g.draw(t),t.circle(s.x,s.y,i,void 0,"#ff0000",n,.5)}m.draw(t)}};e.exports=a;var h=t("../../libraries/actions/SelectAction"),c=t("../../libraries/actions/DeleteAction"),l=t("../../libraries/actions/GroupAction"),u=t("../../libraries/ObjectUtils").GetAllThingsBetween,d=t("../Input"),p=t("../ICDesigner"),g=t("../TransformController"),m=t("../SelectionBox"),v=t("../selectionpopup/SelectionPopup"),f=t("./Tool"),x=t("../../models/IOObject"),b=t("../../models/Wire"),y=t("../../models/WirePort"),C=t("../../libraries/Context").getCurrentContext},{"../../libraries/Constants":29,"../../libraries/Context":30,"../../libraries/ObjectUtils":35,"../../libraries/actions/DeleteAction":40,"../../libraries/actions/GroupAction":41,"../../libraries/actions/SelectAction":44,"../../libraries/math/Vector":51,"../../models/IOObject":54,"../../models/Wire":58,"../../models/WirePort":59,"../ICDesigner":2,"../Input":3,"../SelectionBox":6,"../TransformController":7,"../selectionpopup/SelectionPopup":22,"./Tool":26}],26:[function(t,e,s){var i;e.exports.setCurrent=function(t){i&&i.deactivate(),i=t,t.isActive=!0},e.exports.getCurrent=function(){return i}},{}],27:[function(t,e,s){var i={isActive:!1,clickOPort:!1,wire:void 0,activate:function(t,e){n.setCurrent(this),console.log(t),this.wire=new h(e),this.clickOPort=t instanceof c,(this.clickOPort?t.connect(this.wire):this.wire.connect(t))?(this.onMouseMove(),e.addWire(this.wire)):a.activate()},deactivate:function(){this.wire=void 0},onKeyDown:function(){},onKeyUp:function(){code===ESC_KEY&&(this.removeWire(l().getWires()),a.activate(),u())},removeWire:function(t){for(var e=0;e<t.length&&t[e]!==this.wire;e++);t.splice(e,1),this.clickOPort?this.wire.input.disconnect(this.wire):this.wire.disconnect()},onKeyDown:function(){},onKeyUp:function(){},onMouseDown:function(){},onMouseMove:function(){return this.clickOPort?this.wire.curve.update(this.wire.curve.p1,o.getWorldMousePos(),this.wire.curve.c1,o.getWorldMousePos()):this.wire.curve.update(o.getWorldMousePos(),this.wire.curve.p2,o.getWorldMousePos(),this.wire.curve.c2),!0},onMouseUp:function(){},onClick:function(){for(var t=l().getObjects(),e=l().getWires(),s=o.getWorldMousePos(),i=0;i<t.length;i++){var n=-1;if(this.clickOPort&&-1!==(n=t[i].iPortContains(s))&&(this.wire.connect(t[i].inputs[n])||this.removeWire(e)),this.clickOPort||-1===(n=t[i].oPortContains(s))||t[i].outputs[n].connect(this.wire)||this.removeWire(e),-1!==n){var h=new r(this.wire);return l().addAction(h),a.activate(),!0}}return this.removeWire(e),a.activate(),!0},draw:function(){}};e.exports=i;t("../../libraries/actions/PlaceAction");var r=t("../../libraries/actions/PlaceWireAction"),o=t("../Input"),n=t("./Tool"),a=t("./SelectionTool"),h=t("../../models/Wire"),c=t("../../models/OPort"),l=t("../../libraries/Context").getCurrentContext,u=t("../../views/Renderer").render},{"../../libraries/Context":30,"../../libraries/actions/PlaceAction":42,"../../libraries/actions/PlaceWireAction":43,"../../models/OPort":57,"../../models/Wire":58,"../../views/Renderer":82,"../Input":3,"./SelectionTool":25,"./Tool":26}],28:[function(t,e,s){e.exports=class{constructor(t,e,s){this.canvas=t.renderer.canvas,this.pos=e||i(0,0),this.zoom=s||1,this.center=i(0,0),this.transform=new o(i(0,0),i(0,0),0,this),this.dirty=!0}resize(){this.center=i(this.canvas.width,this.canvas.height).scale(.5)}updateMatrix(){if(this.dirty){this.dirty=!1,this.mat=new r,this.mat.translate(this.pos),this.mat.scale(i(this.zoom,this.zoom)),this.inv=this.mat.inverse();var t=this.getWorldPos(i(0,0)),e=this.getWorldPos(i(this.canvas.width,this.canvas.height));this.transform.setPos(e.add(t).scale(.5)),this.transform.setSize(e.sub(t))}}translate(t,e){this.dirty=!0,this.pos.x+=t,this.pos.y+=e}zoomBy(t){this.dirty=!0,this.zoom*=t}cull(t){return n(t,this.getTransform())}getTransform(){return this.updateMatrix(),this.transform}getMatrix(){return this.updateMatrix(),this.mat}getInverseMatrix(){return this.updateMatrix(),this.inv}getScreenPos(t){return this.getInverseMatrix().mul(t).add(this.center)}getWorldPos(t){return this.getMatrix().mul(t.sub(this.center))}};var i=t("./math/Vector").V,r=t("./math/Matrix"),o=t("./math/Transform"),n=t("./math/MathUtils").TransformContains},{"./math/MathUtils":48,"./math/Matrix":49,"./math/Transform":50,"./math/Vector":51}],29:[function(t,e,s){var i=Math.pow(70,2),r=Math.pow(80,2);e.exports.DEFAULT_SIZE=50,e.exports.GRID_SIZE=50,e.exports.DEFAULT_FILL_COLOR="#ffffff",e.exports.DEFAULT_BORDER_COLOR="#000000",e.exports.DEFAULT_ON_COLOR="#3cacf2",e.exports.PROPAGATION_TIME=1,e.exports.IO_PORT_LENGTH=60,e.exports.IO_PORT_RADIUS=7,e.exports.IO_PORT_BORDER_WIDTH=1,e.exports.IO_PORT_LINE_WIDTH=2,e.exports.WIRE_DIST_THRESHOLD=5,e.exports.WIRE_DIST_THRESHOLD2=25,e.exports.WIRE_DIST_ITERATIONS=10,e.exports.WIRE_NEWTON_ITERATIONS=5,e.exports.WIRE_SNAP_THRESHOLD=10,e.exports.ROTATION_CIRCLE_RADIUS=75,e.exports.ROTATION_CIRCLE_THICKNESS=5,e.exports.ROTATION_CIRCLE_THRESHOLD=5,e.exports.ROTATION_CIRCLE_R1=i,e.exports.ROTATION_CIRCLE_R2=r,e.exports.SIDENAV_WIDTH=200,e.exports.ITEMNAV_WIDTH=200,e.exports.LEFT_MOUSE_BUTTON=0,e.exports.RIGHT_MOUSE_BUTTON=1,e.exports.OPTION_KEY=18,e.exports.SHIFT_KEY=16,e.exports.DELETE_KEY=8,e.exports.ENTER_KEY=13,e.exports.ESC_KEY=27,e.exports.A_KEY=65,e.exports.C_KEY=67,e.exports.V_KEY=86,e.exports.X_KEY=88,e.exports.Y_KEY=89,e.exports.Z_KEY=90,e.exports.CONTROL_KEY=17,e.exports.COMMAND_KEY=91},{}],30:[function(t,e,s){var i,r;var o=!0;e.exports=class{constructor(t){this.uidmanager=new n(this),this.designer=t}reset(){this.designer.reset()}render(){this.designer.render()}propogate(t,e,s){this.designer.propogate(t,e,s)}add(t){t instanceof a?this.addWire(t):this.addObject(t)}addObject(t){this.designer.addObject(t),this.uidmanager.giveUIDTo(t)}addObjects(t){for(var e=0;e<t.length;e++)this.addObject(t[e])}addWire(t){this.designer.addWire(t),this.uidmanager.giveUIDTo(t)}addWires(t){for(var e=0;e<t.length;e++)this.addWire(t[e])}addAction(t){this.designer.history.add(t)}setCursor(t){this.designer.renderer.setCursor(t)}remove(t){var e=this.getIndexOf(t);-1!==e&&(t instanceof a?this.designer.getWires().splice(e,1):this.designer.getObjects().splice(e,1))}undo(){this.designer.history.undo()}redo(){this.designer.history.redo()}redistributeUIDs(){this.uidmanager.redistribute()}getDesigner(){return this.designer}getRenderer(){return this.designer.renderer}getCamera(){return this.designer.camera}getHistoryManager(){return this.designer.history}getObjects(){return h(this.designer.objects)}getWires(){return h(this.designer.wires)}getIndexOf(t){return t instanceof a?this.designer.getIndexOfWire(t):this.designer.getIndexOfObject(t)}findByUID(t){return FindObjectByUID(t)||FindWireByUID(t)}findObjectByUID(t){return n.find(this.getObjects(),t)}findWireByUID(t){return n.find(this.getWires(),t)}},e.exports.setCurrentContext=function(t){i=t},e.exports.getCurrentContext=function(){return i},e.exports.setMainContext=function(t){r=t},e.exports.getMainContext=function(){return r},e.exports.setSaved=function(t){o=t},e.exports.isSaved=function(){return o},e.exports.reset=function(){(i=r).reset()};var n=t("./UIDManager"),a=t("../models/Wire"),h=t("./Utils").CopyArray},{"../models/Wire":58,"./UIDManager":37,"./Utils":38}],31:[function(t,e,s){function i(t,e,s){for(var i=0;i<t.length;i++)for(var r=t[i].inputs,o=0;o<r.length;o++)if(r[o]===e)return s[i].inputs[o]}e.exports.CopyGroup=function(t){if(0===t.length)return[];for(var e=[],s=0;s<t.length;s++)t[s]instanceof o?t.splice(s--,1):e[s]=t[s].copy();var n=[];for(s=0;s<t.length;s++)for(var a=t[s],h=0;h<a.outputs.length;h++)for(var c=a.outputs[h].connections,l=0;l<c.length;l++){for(var u=c[l];u instanceof r||u instanceof o;)u=u.connection;if(void 0==i(t,u,e))break;var d=c[l].copy();e[s].outputs[h].connect(d);for(var p=c[l];p.connection instanceof o;){var g=new o(a.context);d.connect(g),n.push(d),d=(p=p.connection.connection).copy(),g.connect(d),e.push(g)}var m=i(t,p.connection,e);d.connect(m),n.push(d)}for(s=0;s<t.length;s++)e[s].isOn=t[s].isOn,0===t[s].inputs.length&&e[s].activate(t[s].isOn);for(s=0;s<n.length;s++)0===t[s].inputs.length&&e[s].activate(t[s].isOn);return{objects:e,wires:n}},e.exports.FindIPort=i;var r=t("../models/Wire"),o=t("../models/WirePort")},{"../models/Wire":58,"../models/WirePort":59}],32:[function(t,e,s){var i=t("./Constants").Y_KEY,r=t("./Constants").Z_KEY;e.exports=class{constructor(){this.undoStack=[],this.redoStack=[]}onKeyDown(t,e){o.getModifierKeyDown()&&(t===i||t===r&&o.getShiftKeyDown()?this.redo():t===r&&this.undo())}add(t){if(!(t instanceof h&&0==t.actions.length)){if(t instanceof h&&t.actions[0]instanceof a){var e=this.undoStack[this.undoStack.length-1];if(this.undoStack.length>0&&!t.actions[0].flip&&e instanceof h&&e.actions[0]instanceof a&&e.actions[0].flip){var s=new h;return s.add(t),s.add(e),this.redoStack=[],void(this.undoStack[this.undoStack.length-1]=s)}}this.redoStack=[],this.undoStack.push(t)}}undo(){if(this.undoStack.length>0){var t=this.undoStack.pop();t.undo(),this.redoStack.push(t),n.update(),c()}}redo(){if(this.redoStack.length>0){var t=this.redoStack.pop();t.redo(),this.undoStack.push(t),n.update(),c()}}};var o=t("../controllers/Input"),n=t("../controllers/selectionpopup/SelectionPopup"),a=t("./actions/SelectAction"),h=t("./actions/GroupAction"),c=t("../views/Renderer").render},{"../controllers/Input":3,"../controllers/selectionpopup/SelectionPopup":22,"../views/Renderer":82,"./Constants":29,"./actions/GroupAction":41,"./actions/SelectAction":44}],33:[function(t,e,s){var i=[];i.load=function(t,e,s){var r=new Image;r.onload=function(){i[t[e]]=r,r.dx=0,r.dy=0,r.ratio=r.width/r.height,e===t.length-1?s():i.load(t,e+1,s)},r.src="img/items/"+t[e]},e.exports=i},{}],34:[function(t,e,s){e.exports.getChildNode=function(t,e){for(var s=0;s<t.childNodes.length;s++)if(t.childNodes[s].nodeName===e)return t.childNodes[s]},e.exports.getChildrenByTagName=function(t,e){for(var s=[],i=0;i<t.childNodes.length;i++)t.childNodes[i].nodeName===e&&s.push(t.childNodes[i]);return s},e.exports.getBooleanValue=function(t,e){return void 0==t?e:"true"===t.childNodes[0].nodeValue},e.exports.getIntValue=function(t,e){return void 0==t?e:parseInt(t.childNodes[0].nodeValue)},e.exports.getFloatValue=function(t,e){return void 0==t?e:parseFloat(t.childNodes[0].nodeValue)},e.exports.getStringValue=function(t,e){return void 0==t?e:t.childNodes[0].nodeValue}},{}],35:[function(t,e,s){e.exports.GetAllThingsBetween=function(t){for(var e=[],s=[],h=0;h<t.length;h++)t[h]instanceof r||t[h]instanceof o?s.push(t[h]):t[h]instanceof i&&e.push(t[h]);var c=[];for(h=0;h<e.length;h++){c.push(e[h]);for(var l=0;l<e[h].inputs.length;l++)for(p=e[h].inputs[l].input;void 0!=p&&!(p instanceof a);)void 0==FindByUID(c,p.uid)&&c.push(p),p=p.input;for(l=0;l<e[h].outputs.length;l++)for(var u=e[h].outputs[l],d=0;d<u.connections.length;d++)for(p=u.connections[d];void 0!=p&&!(p instanceof n);)void 0==FindByUID(c,p.uid)&&c.push(p),p=p.connection}for(h=0;h<s.length;h++){c.push(s[h]);for(var p=s[h].input;void 0!=p&&!(p instanceof a);)void 0==FindByUID(c,p.uid)&&c.push(p),p=p.input;for(p=s[h].connection;void 0!=p&&!(p instanceof n);)void 0==FindByUID(c,p.uid)&&c.push(p),p=p.connection}return c},e.exports.GetAllWires=function(t){for(var e=[],s=0;s<t.length;s++)for(var i=t[s],r=0;r<i.outputs.length;r++)for(var n=i.outputs[r].connections,a=0;a<n.length;a++){for(var h=n[a];h.connection instanceof o;)e.push(h),h=h.connection.connection;e.push(h)}return e},e.exports.FindIC=function(t,e){for(var s=0;s<e.length;s++)if(e[s].icuid===t)return e[s]},e.exports.SeparateGroup=function(t){for(var e=[],s=[],i=[],r=0;r<t.length;r++){var o=t[r];o instanceof h||o instanceof c||o instanceof l?e.push(o):o instanceof u?i.push(o):s.push(o)}return{inputs:e,components:s,outputs:i}};var i=t("../models/IOObject"),r=t("../models/Wire"),o=t("../models/WirePort"),n=t("../models/IPort"),a=t("../models/OPort"),h=t("../models/ioobjects/inputs/Switch"),c=t("../models/ioobjects/inputs/Button"),l=t("../models/ioobjects/inputs/Clock"),u=t("../models/ioobjects/outputs/LED")},{"../models/IOObject":54,"../models/IPort":56,"../models/OPort":57,"../models/Wire":58,"../models/WirePort":59,"../models/ioobjects/inputs/Button":66,"../models/ioobjects/inputs/Clock":67,"../models/ioobjects/inputs/Switch":71,"../models/ioobjects/outputs/LED":80}],36:[function(t,e,s){var i=t("./Constants").PROPAGATION_TIME;e.exports=class{constructor(t,e,s,r,o){this.sender=e,this.receiver=s,this.signal=r,0===t.updateRequests&&(t.updateRequests++,setTimeout(o,i))}send(){this.receiver.activate(this.signal)}}},{"./Constants":29}],37:[function(t,e,s){class i{constructor(t){this.context=t,this.counter=0}giveUIDTo(t){t.uid||(t.uid=this.counter++)}redistribute(){var t=this.context.getObjects().concat(this.context.getWires());this.counter=0;for(var e=0;e<t.length;e++)t[e].uid=this.counter++}}i.find=function(t,e){for(var s=0;s<t.length;s++)if(t[s].uid===e)return t[s]},e.exports=i},{}],38:[function(t,e,s){e.exports.CopyArray=function(t){for(var e=[],s=0;s<t.length;s++)e.push(t[s]);return e},e.exports.GetBrowser=function(){if(void 0!=navigator){var t,e=navigator.userAgent,s=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(s[1])?{name:"IE",version:(t=/\brv[ :]+(\d+)/g.exec(e)||[])[1]||""}:"Chrome"===s[1]&&null!=(t=e.match(/\bOPR|Edge\/(\d+)/))?{name:"Opera",version:t[1]}:(s=s[2]?[s[1],s[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=e.match(/version\/(\d+)/i))&&s.splice(1,1,t[1]),{name:s[0],version:s[1]})}}},{}],39:[function(t,e,s){e.exports=class{constructor(){this.context=i(),r(!1)}undo(){}redo(){}};var i=t("../Context").getCurrentContext,r=t("../Context").setSaved},{"../Context":30}],40:[function(t,e,s){var i=t("./Action");e.exports=i},{"./Action":39}],41:[function(t,e,s){var i=t("./Action");e.exports=class extends i{constructor(){super(),this.actions=[]}add(t){this.actions.push(t)}undo(){for(var t=this.actions.length-1;t>=0;t--)this.actions[t].undo()}redo(){for(var t=0;t<this.actions.length;t++)this.actions[t].redo()}}},{"./Action":39}],42:[function(t,e,s){var i=t("./Action");e.exports=class extends i{constructor(t){super(),this.obj=t}undo(){this.context.remove(this.obj)}redo(){this.context.addObject(this.obj)}}},{"./Action":39}],43:[function(t,e,s){var i=t("./Action");e.exports=class extends i{constructor(t){super(),this.wire=t,this.input=void 0,this.connection=void 0}undo(){void 0==this.input&&(this.input=this.wire.input),void 0==this.connection&&(this.connection=this.wire.connection);var t=this.context.getIndexOf(this.wire);this.context.getWires().splice(t,1),this.wire.disconnect(this.wire.connection),this.wire.input.disconnect(this.wire)}redo(){this.context.getWires().push(this.wire),this.wire.connect(this.connection),this.input.connect(this.wire)}}},{"./Action":39}],44:[function(t,e,s){var i=t("./Action");e.exports=class extends i{constructor(t,e){super(),this.obj=t,this.flip=e}undo(){this.flip?this.reselect():this.deselect()}redo(){this.flip?this.deselect():this.reselect()}reselect(){r.select([this.obj])}deselect(){r.deselect([this.obj])}};var r=t("../../controllers/tools/SelectionTool")},{"../../controllers/tools/SelectionTool":25,"./Action":39}],45:[function(t,e,s){var i=t("./Action");e.exports=class extends i{constructor(t){super(),this.wireport=t.connection,this.wire=t,this.newwire=this.wireport.connection,this.connection=this.newwire.connection}undo(){this.context.remove(this.wireport),this.context.remove(this.newwire),this.wire.disconnect(this.wireport),this.newwire.disconnect(this.connection),this.wire.connect(this.connection)}redo(){this.context.addObject(this.wireport),this.context.addWire(this.newwire),this.wire.disconnect(this.connection),this.wire.connect(this.wireport),this.newwire.connect(this.connection)}}},{"./Action":39}],46:[function(t,e,s){var i=t("./Action");e.exports=class extends i{constructor(t,e,s){super(),this.obj=t,this.t0=e,this.t1=s}undo(){this.obj.setTransform(this.t0),this.updatePopup()}redo(){this.obj.setTransform(this.t1),this.updatePopup()}updatePopup(){this.obj.selected&&(r.recalculateMidpoint(),o.onMove())}};t("./GroupAction");var r=t("../../controllers/tools/SelectionTool"),o=t("../../controllers/selectionpopup/SelectionPopup")},{"../../controllers/selectionpopup/SelectionPopup":22,"../../controllers/tools/SelectionTool":25,"./Action":39,"./GroupAction":41}],47:[function(t,e,s){var i=t("../Constants").WIRE_DIST_ITERATIONS,r=t("../Constants").WIRE_NEWTON_ITERATIONS,o=t("../Constants").WIRE_DIST_THRESHOLD2;class n{constructor(t,e,s,i){this.p1=a(t.x,t.y),this.p2=a(e.x,e.y),this.c1=a(s.x,s.y),this.c2=a(i.x,i.y),this.dirty=!0,this.boundingBox=new h(0,0,0,u().getCamera())}update(t,e,s,i){this.p1.x=t.x,this.p1.y=t.y,this.p2.x=e.x,this.p2.y=e.y,this.c1.x=s.x,this.c1.y=s.y,this.c2.x=i.x,this.c2.y=i.y}updateBoundingBox(){if(this.dirty){this.dirty=!1;var t=a(0,0),e=a(0,0),s=this.getPos(0),i=this.getPos(1),r=this.c1.sub(this.c2).scale(3).add(this.p2.sub(this.p1)),o=this.p1.sub(this.c1.scale(2).add(this.c2)).scale(2),n=this.c1.sub(this.p1),h=o.y*o.y-4*r.y*n.y,l=-1!==(h=h>=0?Math.sqrt(h):-1)?c((-o.y+h)/(2*r.y),0,1):0,u=-1!==h?c((-o.y-h)/(2*r.y),0,1):0;e.y=Math.max(this.getY(l),this.getY(u),s.y,i.y),t.y=Math.min(this.getY(l),this.getY(u),s.y,i.y);var d=o.x*o.x-4*r.x*n.x;-1!==(d=d>=0?Math.sqrt(d):-1)&&c((-o.x+d)/(2*r.x),0,1),-1!==d&&c((-o.x-d)/(2*r.x),0,1);e.x=Math.max(this.getX(l),this.getX(u),s.x,i.x),t.x=Math.min(this.getX(l),this.getX(u),s.x,i.x),this.boundingBox.setSize(a(e.x-t.x,e.y-t.y)),this.boundingBox.setPos(a((e.x-t.x)/2+t.x,(e.y-t.y)/2+t.y))}}draw(t,e,s){var i=s.parent.camera,r=i.getScreenPos(this.p1),o=i.getScreenPos(this.p2),n=i.getScreenPos(this.c1),a=i.getScreenPos(this.c2);s.curve(r.x,r.y,o.x,o.y,n.x,n.y,a.x,a.y,t,e)}getX(t){var e=1-t;return this.p1.x*e*e*e+3*this.c1.x*t*e*e+3*this.c2.x*t*t*e+this.p2.x*t*t*t}getY(t){var e=1-t;return this.p1.y*e*e*e+3*this.c1.y*t*e*e+3*this.c2.y*t*t*e+this.p2.y*t*t*t}getPos(t){return a(this.getX(t),this.getY(t))}getDX(t){var e=1-t;return-3*this.p1.x*e*e+3*this.c1.x*e*(1-3*t)+3*this.c2.x*t*(2-3*t)+3*this.p2.x*t*t}getDY(t){var e=1-t;return-3*this.p1.y*e*e+3*this.c1.y*e*(1-3*t)+3*this.c2.y*t*(2-3*t)+3*this.p2.y*t*t}getVel(t){return a(this.getDX(t),this.getDY(t))}getDDX(t){return 6*((-this.p1.x+3*this.c1.x-3*this.c2.x+this.p2.x)*t+(this.p1.x-2*this.c1.x+this.c2.x))}getDDY(t){return 6*((-this.p1.y+3*this.c1.y-3*this.c2.y+this.p2.y)*t+(this.p1.y-2*this.c1.y+this.c2.y))}getDist(t,e,s){var i=this.getX(t)-e,r=this.getY(t)-s;return Math.sqrt(i*i+r*r)}getDist2(t,e,s){var i=this.getX(t)-e,r=this.getY(t)-s;return i*i+r*r}getDistDenominator(t,e,s){var i=this.getX(t)-e,r=this.getY(t)-s;return i*i+r*r}getDistDenominatorDerivative(t,e,s){return 2*(this.getX(t)-e)*this.getDX(t)+2*(this.getY(t)-s)*this.getDY(t)}getDistNumerator(t,e,s){var i=this.getX(t)-e,r=this.getY(t)-s;return this.getDX(t)*i+this.getDY(t)*r}getDistNumeratorDerivative(t,e,s){var i=this.getX(t)-e,r=this.getY(t)-s,o=this.getDX(t),n=this.getDY(t);return o*o+i*this.getDDX(t)+n*n+r*this.getDDY(t)}getNearestT(t,e){for(var s=1e20,n=-1,a=0;a<=1;a+=1/i){var h=this.getDist(a,t,e);h<s&&(n=a,s=h)}var c=l(r,n,t,e,(t,e,s)=>this.getDistDenominator(t,e,s),(t,e,s)=>this.getDistDenominatorDerivative(t,e,s));if(this.getDist2(c,t,e)<o)return c;var u=l(r,n,t,e,(t,e,s)=>this.getDistNumerator(t,e,s),(t,e,s)=>this.getDistNumeratorDerivative(t,e,s));return this.getDist2(u,t,e)<o?u:-1}getBoundingBox(){return this.updateBoundingBox(),this.boundingBox}copy(){return new n(this.p1.copy(),this.p2.copy(),this.c1.copy(),this.c2.copy())}writeTo(t){var e=g(t,"bezier");m(e,"p1x",this.p1.x),m(e,"p1y",this.p1.y),m(e,"p2x",this.p2.x),m(e,"p2y",this.p2.y),m(e,"c1x",this.c1.x),m(e,"c1y",this.c1.y),m(e,"c2x",this.c2.x),m(e,"c2y",this.c2.y)}load(t){var e=a(p(d(t,"p1x")),p(d(t,"p1y"))),s=a(p(d(t,"p2x")),p(d(t,"p2y"))),i=a(p(d(t,"c1x")),p(d(t,"c1y"))),r=a(p(d(t,"c2x")),p(d(t,"c2y")));this.update(e,s,i,r)}}e.exports=n;var a=t("./Vector").V,h=t("./Transform"),c=t("./MathUtils").Clamp,l=t("./MathUtils").FindRoots,u=t("../Context").getCurrentContext,d=t("../ImportUtils").getChildNode,p=t("../ImportUtils").getFloatValue,g=t("../../controllers/Exporter").createChildNode,m=t("../../controllers/Exporter").createTextElement},{"../../controllers/Exporter":1,"../Constants":29,"../Context":30,"../ImportUtils":34,"./MathUtils":48,"./Transform":50,"./Vector":51}],48:[function(t,e,s){t("../Constants").WIRE_DIST_THRESHOLD2;var i=t("./Vector").V;function r(t,e,s){return Math.min(Math.max(t,e),s)}e.exports.CircleContains=function(t,e){return t.toLocalSpace(e).len2()<=t.size.x*t.size.x/4},e.exports.RectContains=function(t,e){var s=t.size.scale(.5),i=t.size.scale(-.5),r=t.toLocalSpace(e);return r.x>i.x&&r.y>i.y&&r.x<s.x&&r.y<s.y},e.exports.TransformContains=function(t,e){if(Math.abs(t.getAngle())<=1e-5&&Math.abs(e.getAngle())<=1e-5){var s=t.getPos(),i=t.getSize(),r=e.getPos(),o=e.getSize();return 2*Math.abs(s.x-r.x)<i.x+o.x&&2*Math.abs(s.y-r.y)<i.y+o.y}var n=t.getRadius()+e.getRadius(),a=t.getPos().sub(e.getPos());if(a.dot(a)>n*n)return!1;for(var h=t.getLocalCorners(),c=e.getCorners(),l=[],u=0;u<4;u++)l[u]=t.toLocalSpace(c[u]),l[u].x+=1e-4*u,l[u].y+=1e-4*u;var d=h.concat(l);v=f=d[0].x,x=b=d[4].x;for(var p=1;p<4;p++)v=Math.min(d[p].x,v),f=Math.max(d[p].x,f),x=Math.min(d[p+4].x,x),b=Math.max(d[p+4].x,b);if(f<x||b<v)return!1;for(v=f=d[0].y,x=b=d[4].y,p=1;p<4;p++)v=Math.min(d[p].y,v),f=Math.max(d[p].y,f),x=Math.min(d[p+4].y,x),b=Math.max(d[p+4].y,b);if(f<x||b<v)return!1;var g=[l[3].sub(l[0]),l[3].sub(l[2])];for(u=0;u<g.length;u++){var m=g[u],v=void 0,f=void 0,x=void 0,b=void 0;for(p=0;p<4;p++){var y=d[p].dot(m);v=Math.min(y,v||1/0),f=Math.max(y,f||-1/0);var C=d[p+4].dot(m);x=Math.min(C,x||1/0),b=Math.max(C,b||-1/0)}if(f<x||b<v)return!1}return!0},e.exports.GetNearestPointOnRect=function(t,e,s){return s.x<t.x?i(t.x,r(s.y,t.y,e.y)):s.x>e.x?i(e.x,r(s.y,t.y,e.y)):s.y<t.y?i(r(s.x,t.x,e.x),t.y):s.y>e.y?i(r(s.x,t.x,e.x),e.y):i(0,0)},e.exports.Clamp=r,e.exports.FindRoots=function(t,e,s,i,o,n){var a=e;do{var h=o(a,s,i),c=n(a,s,i);if(0===c)break;a=r(a-=h/c,.01,.99)}while(t-- >0);return a}},{"../Constants":29,"./Vector":51}],49:[function(t,e,s){var i=t("./Vector").V;class r{constructor(t){if(this.mat=[],this.identity(),t instanceof r)for(var e=0;e<6;e++)this.mat[e]=t.mat[e]}zero(){for(var t=0;t<6;t++)this.mat[t]=0;return this}identity(){return this.zero(),this.mat[0]=1,this.mat[3]=1,this}mul(t){var e=i(0,0);return e.x=this.mat[0]*t.x+this.mat[2]*t.y+this.mat[4],e.y=this.mat[1]*t.x+this.mat[3]*t.y+this.mat[5],e}mult(t){var e=new r;return e.mat[0]=this.mat[0]*t.mat[0]+this.mat[2]*t.mat[1],e.mat[1]=this.mat[1]*t.mat[0]+this.mat[3]*t.mat[1],e.mat[2]=this.mat[0]*t.mat[2]+this.mat[2]*t.mat[3],e.mat[3]=this.mat[1]*t.mat[2]+this.mat[3]*t.mat[3],e.mat[4]=this.mat[0]*t.mat[4]+this.mat[2]*t.mat[5]+this.mat[4],e.mat[5]=this.mat[1]*t.mat[4]+this.mat[3]*t.mat[5]+this.mat[5],e}translate(t){this.mat[4]+=this.mat[0]*t.x+this.mat[2]*t.y,this.mat[5]+=this.mat[1]*t.x+this.mat[3]*t.y}rotate(t){var e=Math.cos(t),s=Math.sin(t),i=this.mat[0]*e+this.mat[2]*s,r=this.mat[1]*e+this.mat[3]*s,o=this.mat[0]*-s+this.mat[2]*e,n=this.mat[1]*-s+this.mat[3]*e;this.mat[0]=i,this.mat[1]=r,this.mat[2]=o,this.mat[3]=n}scale(t){this.mat[0]*=t.x,this.mat[1]*=t.x,this.mat[2]*=t.y,this.mat[3]*=t.y}inverse(){var t,e=new Array(6);if(e[0]=this.mat[3],e[1]=-this.mat[1],e[2]=-this.mat[2],e[3]=this.mat[0],e[4]=this.mat[2]*this.mat[5]-this.mat[4]*this.mat[3],e[5]=this.mat[4]*this.mat[1]-this.mat[0]*this.mat[5],0!=(t=this.mat[0]*this.mat[3]-this.mat[1]*this.mat[2])){t=1/t;for(var s=new r,i=0;i<6;i++)s.mat[i]=e[i]*t;return s}}print(){console.log("["+this.mat[0].toFixed(3)+", "+this.mat[2].toFixed(3)+", "+this.mat[4].toFixed(3)+"]\n["+this.mat[1].toFixed(3)+", "+this.mat[3].toFixed(3)+", "+this.mat[5].toFixed(3)+"]")}}e.exports=r},{"./Vector":51}],50:[function(t,e,s){var i=t("./Vector").V,r=t("./Matrix");class o{constructor(t,e,s,r){this.parent=void 0,this.pos=i(t.x,t.y),this.size=i(e.x,e.y),this.angle=s,this.scale=i(1,1),this.corners=[],this.localCorners=[],this.camera=r,this.dirty=!0,this.dirtySize=!0,this.dirtyCorners=!0,this.updateMatrix()}updateMatrix(t){this.dirty&&(this.dirty=!1,this.matrix=new r,this.matrix.translate(this.pos),this.matrix.rotate(this.angle),this.matrix.scale(this.scale),void 0!=this.parent&&(this.matrix=this.parent.getMatrix().mult(this.matrix)),this.inverse=this.matrix.inverse())}updateSize(){this.dirtySize&&(this.dirtySize=!1,this.localCorners=[this.size.scale(i(-.5,.5)),this.size.scale(i(.5,.5)),this.size.scale(i(.5,-.5)),this.size.scale(i(-.5,-.5))],this.radius=Math.sqrt(this.size.x*this.size.x+this.size.y*this.size.y)/2)}updateCorners(){if(this.dirtyCorners){this.dirtyCorners=!1;for(var t=this.getLocalCorners(),e=0;e<4;e++)this.corners[e]=this.toWorldSpace(t[e])}}transformCtx(t){this.updateMatrix();var e=new r(this.matrix),s=this.camera.getScreenPos(i(e.mat[4],e.mat[5]));e.mat[4]=s.x,e.mat[5]=s.y,e.scale(i(1/this.camera.zoom,1/this.camera.zoom)),t.setTransform(e.mat[0],e.mat[1],e.mat[2],e.mat[3],e.mat[4],e.mat[5])}rotateAbout(t,e){this.setAngle(t),this.setPos(this.pos.sub(e));var s=Math.cos(t),r=Math.sin(t),o=this.pos.x*s-this.pos.y*r,n=this.pos.y*s+this.pos.x*r;this.setPos(i(o,n).add(e)),this.dirty=!0,this.dirtyCorners=!0}setParent(t){this.parent=t,this.dirty=!0,this.dirtyCorners=!0}setCamera(t){this.camera=t}setPos(t){this.pos.x=t.x,this.pos.y=t.y,this.dirty=!0,this.dirtyCorners=!0}setAngle(t){this.angle=t,this.dirty=!0,this.dirtyCorners=!0}setScale(t){this.scale.x=t.x,this.scale.y=t.y,this.dirty=!0}setSize(t){this.size.x=t.x,this.size.y=t.y,this.dirtySize=!0,this.dirtyCorners=!0}setWidth(t){this.size.x=t,this.dirtySize=!0,this.dirtyCorners=!0}setHeight(t){this.size.y=t,this.dirtySize=!0,this.dirtyCorners=!0}toLocalSpace(t){return this.getInverseMatrix().mul(t)}toWorldSpace(t){return this.getMatrix().mul(t)}getPos(){return i(this.pos.x,this.pos.y)}getAngle(){return this.angle}getScale(){return i(this.scale.x,this.scale.y)}getSize(){return this.size}getRadius(){return this.updateSize(),this.radius}getMatrix(){return this.updateMatrix(),this.matrix}getInverseMatrix(){return this.updateMatrix(),this.inverse}getBottomLeft(){return this.updateCorners(),this.corners[0]}getBottomRight(){return this.updateCorners(),this.corners[1]}getTopRight(){return this.updateCorners(),this.corners[2]}getTopLeft(){return this.updateCorners(),this.corners[3]}getCorners(){return this.updateCorners(),this.corners}getLocalCorners(){return this.updateSize(),this.localCorners}equals(t){if(!(t instanceof o))return!1;for(var e=this.getMatrix(),s=t.getMatrix(),i=0;i<e.mat.length;i++)if(e[i]!==s[i])return!1;return!0}print(){this.updateMatrix(),this.matrix.print()}copy(){var t=new o(this.pos.copy(),this.size.copy(),this.angle,this.camera);return t.scale=this.scale.copy(),t.dirty=!0,t}}e.exports=o},{"./Matrix":49,"./Vector":51}],51:[function(t,e,s){class i{constructor(t,e){this.set(t,e)}set(t,e){t instanceof i?(this.x=t.x?t.x:0,this.y=t.y?t.y:0):(this.x=t||0,this.y=e||0)}translate(t,e){t instanceof i?this.set(this.add(t)):this.set(this.x+t,this.y+e)}add(t,e){return t instanceof i?new i(this.x+t.x,this.y+t.y):new i(this.x+t,this.y+e)}sub(t,e){return t instanceof i?new i(this.x-t.x,this.y-t.y):new i(this.x-t,this.y-e)}scale(t){return t instanceof i?new i(t.x*this.x,t.y*this.y):new i(t*this.x,t*this.y)}normalize(){var t=this.len();if(0===t)return new i(0,0);var e=1/t;return new i(this.x*e,this.y*e)}len(){return Math.sqrt(this.x*this.x+this.y*this.y)}len2(){return this.x*this.x+this.y*this.y}distanceTo(t){return this.sub(t).len()}dot(t){return this.x*t.x+this.y*t.y}project(t){return this.scale(t.dot(this)/this.len2())}copy(){return new i(this.x,this.y)}}e.exports=i,e.exports.V=function(t,e){return new i(t,e)}},{}],52:[function(t,e,s){e.exports=class{constructor(t,e,s){this.parent=t,this.div=document.getElementById(e),this.divtext=s?document.getElementById(s):void 0,this.div.oninput=(()=>{i(),this.onChange()}),this.div.onclick=(()=>this.onClick()),this.div.onfocus=(()=>this.onFocus()),this.div.onblur=(()=>this.onBlur())}blur(){this.div.blur()}onShow(){}setValue(t){this.div.value=t}setPlaceholder(t){this.div.placeholder=t}setVisibility(t){this.div.style.display=t,void 0!=this.divtext&&(this.divtext.style.display=t)}setDisabled(t){this.div.disabled=t}getValue(){return this.div.value}onChange(){}onClick(){}onFocus(){this.parent.focused=!0}onBlur(){this.parent.focused=!1}};var i=t("../../views/Renderer").render},{"../../views/Renderer":82}],53:[function(t,e,s){var i=t("../Constants").ITEMNAV_WIDTH;e.exports=class{constructor(t){this.div=document.getElementById(t),this.div.addEventListener("keydown",t=>{this.onKeyDown(t.keyCode)},!1),this.div.addEventListener("keyup",t=>{this.onKeyUp(t.keyCode)},!1),this.div.style.position="absolute",this.focused=!1,this.modules=[],this.setPos(r(0,0)),this.hide()}onKeyDown(t){}onKeyUp(t){}add(t){this.modules.push(t)}update(){this.onShow()}onShow(){for(var t=0;t<this.modules.length;t++)this.modules[t].onShow()}blur(){for(var t=0;t<this.modules.length;t++)this.modules[t].blur()}show(){this.hidden=!1,this.div.style.visibility="visible",this.div.focus(),this.onShow()}hide(){this.hidden=!0,this.div.style.visibility="hidden",this.div.blur()}setPos(t){this.pos=r(t.x,t.y),this.clamp(),this.div.style.left=this.pos.x+"px",this.div.style.top=this.pos.y+"px"}clamp(){this.pos.x=Math.max(Math.min(this.pos.x,window.innerWidth-this.div.clientWidth-1),o.isOpen?i+5:5),this.pos.y=Math.max(Math.min(this.pos.y,window.innerHeight-this.div.clientHeight-1),(header?header.clientHeight:0)+5)}};var r=t("../math/Vector").V,o=t("../../controllers/ItemNavController")},{"../../controllers/ItemNavController":4,"../Constants":29,"../math/Vector":51}],54:[function(t,e,s){var i=t("../libraries/Constants").IO_PORT_RADIUS;e.exports=class{constructor(t,e,s,i,n,a,h,c,u,d,p){void 0==t&&(t=l()),this.context=t,e=void 0==e?0:e,s=void 0==s?0:s,this.transform=new o(r(e,s),r(i,n),0,t.getCamera()),this.cullTransform=new o(this.transform.getPos(),r(0,0),0,t.getCamera()),this.name=this.getDisplayName(),this.img=a,this.isOn=!1,this.isPressable=h,this.maxInputs=c,this.maxOutputs=u,this.selected=!1,this.isPressable&&(this.selectionBoxTransform=new o(r(e,s),r(d,p),0,t.getCamera())),this.outputs=[],this.inputs=[],u>0&&this.setOutputAmount(1)}setInputAmount(t){for(t=h(t,0,this.maxInputs);this.inputs.length>t;)this.inputs.splice(this.inputs.length-1,1);for(;this.inputs.length<t;)this.inputs.push(new n(this));for(var e=0;e<this.inputs.length;e++)this.inputs[e].updatePosition();this.onTransformChange()}setOutputAmount(t){for(t=h(t,0,this.maxOutputs);this.outputs.length>t;)this.outputs.splice(this.outputs.length-1,1);for(;this.outputs.length<t;)this.outputs.push(new a(this));for(var e=0;e<this.outputs.length;e++)this.outputs[e].updatePosition();this.onTransformChange()}onTransformChange(){this.isPressable&&void 0!=this.selectionBoxTransform&&(this.selectionBoxTransform.setPos(this.transform.getPos()),this.selectionBoxTransform.setAngle(this.transform.getAngle()),this.selectionBoxTransform.setScale(this.transform.getScale())),this.updateCullTransform();for(var t=0;t<this.inputs.length;t++)this.inputs[t].onTransformChange();for(t=0;t<this.outputs.length;t++)this.outputs[t].onTransformChange()}updateCullTransform(){var t=r(-this.transform.size.x/2,-this.transform.size.y/2),e=r(this.transform.size.x/2,this.transform.size.y/2);void 0!=this.selectionBoxTransform&&(t.x=Math.min(-this.selectionBoxTransform.size.x/2,t.x),t.y=Math.min(-this.selectionBoxTransform.size.y/2,t.y),e.x=Math.max(this.selectionBoxTransform.size.x/2,e.x),e.y=Math.max(this.selectionBoxTransform.size.y/2,e.y));for(var s=0;s<this.inputs.length;s++){var o=this.inputs[s];t.x=Math.min(o.target.x,t.x),t.y=Math.min(o.target.y,t.y),e.x=Math.max(o.target.x,e.x),e.y=Math.max(o.target.y,e.y)}for(s=0;s<this.outputs.length;s++){var n=this.outputs[s];t.x=Math.min(n.target.x,t.x),t.y=Math.min(n.target.y,t.y),e.x=Math.max(n.target.x,e.x),e.y=Math.max(n.target.y,e.y)}this.cullTransform.setSize(r(e.x-t.x,e.y-t.y));var a=Math.cos(this.transform.getAngle()),h=Math.sin(this.transform.getAngle()),c=(t.x- -this.cullTransform.size.x/2)*a+(t.y- -this.cullTransform.size.y/2)*h,l=(t.y- -this.cullTransform.size.y/2)*a+(t.x- -this.cullTransform.size.x/2)*h;this.cullTransform.setPos(this.transform.getPos().add(r(c,l))),this.cullTransform.setAngle(this.transform.getAngle()),this.cullTransform.setScale(this.transform.getScale()),this.cullTransform.setSize(this.cullTransform.size.add(r(2*i,2*i)))}click(){}press(){}release(){}activate(t,e){void 0==e&&(e=0),this.isOn=t,void 0!=this.outputs[e]&&this.outputs[e].activate(t)}localSpace(){var t=this.context.getRenderer();t.save(),this.transform.transformCtx(t.context)}draw(){this.localSpace();for(var t=0;t<this.inputs.length;t++)this.inputs[t].draw();for(t=0;t<this.outputs.length;t++)this.outputs[t].draw(t);var e=this.context.getRenderer();this.isPressable&&void 0!=this.selectionBoxTransform&&e.rect(0,0,this.selectionBoxTransform.size.x,this.selectionBoxTransform.size.y,this.getCol(),this.getBorderColor()),void 0!=this.img&&e.image(this.img,0,0,this.transform.size.x,this.transform.size.y,this.getImageTint()),e.restore()}remove(){this.context.remove(this);for(var t=0;t<this.outputs.length;t++)this.outputs[t].remove();for(t=0;t<this.inputs.length;t++)this.inputs[t].remove()}contains(t){return c(this.transform,t)}sContains(t){return!this.isPressable&&this.contains(t)||this.isPressable&&!this.contains(t)&&c(this.selectionBoxTransform,t)}iPortContains(t){for(var e=0;e<this.inputs.length;e++)if(this.inputs[e].contains(t))return e;return-1}oPortContains(t){for(var e=0;e<this.outputs.length;e++)if(this.outputs[e].contains(t))return e;return-1}setContext(t){this.context=t,this.transform.setCamera(this.context.getCamera()),void 0!=this.selectionBoxTransform&&this.selectionBoxTransform.setCamera(this.context.getCamera())}setTransform(t){this.transform=t,this.onTransformChange()}setPos(t){this.transform.setPos(t),this.onTransformChange()}setAngle(t){this.transform.setAngle(t),this.onTransformChange()}setRotationAbout(t,e){this.transform.rotateAbout(-this.getAngle(),e),this.transform.rotateAbout(t,e),this.onTransformChange()}setName(t){this.name=t}getCullBox(){return this.cullTransform}getInputAmount(){return this.inputs.length}getImageTint(){return this.getCol()}getCol(){return this.selected?"#1cff3e":void 0}getBorderColor(){return this.selected?"#0d7f1f":void 0}getPos(){return this.transform.pos.copy()}getAngle(){return this.transform.angle}getSize(){return this.transform.size}getMaxInputFieldCount(){return 8}getMinInputFieldCount(){return 2}getName(){return this.name}getDisplayName(){return"IOObject"}getRenderer(){return this.context.getRenderer()}copy(){var t=new this.constructor(this.context);t.transform=this.transform.copy(),t.name=this.name,void 0!=this.selectionBoxTransform&&(t.selectionBoxTransform=this.selectionBoxTransform.copy());for(var e=0;e<this.inputs.length;e++)t.inputs[e]=this.inputs[e].copy(),t.inputs[e].parent=t;for(e=0;e<this.outputs.length;e++)t.outputs[e]=this.outputs[e].copy(),t.outputs[e].parent=t;return t}writeTo(t){var e=v(t,this.constructor.getXMLName());return f(e,"uid",this.uid),f(e,"name",this.getName()),f(e,"x",this.getPos().x),f(e,"y",this.getPos().y),f(e,"angle",this.getAngle()),e}load(t){var e=d(u(t,"uid")),s=p(u(t,"name")),i=g(u(t,"x")),o=g(u(t,"y")),n=g(u(t,"angle")),a=m(u(t,"isOn"),!1);return this.uid=e,this.setName(s),a&&this.click(a),this.setPos(r(i,o)),this.setAngle(n),this}};var r=t("../libraries/math/Vector").V,o=t("../libraries/math/Transform"),n=t("./IPort"),a=t("./OPort"),h=t("../libraries/math/MathUtils").Clamp,c=t("../libraries/math/MathUtils").RectContains,l=t("../libraries/Context").getCurrentContext,u=t("../libraries/ImportUtils").getChildNode,d=t("../libraries/ImportUtils").getIntValue,p=t("../libraries/ImportUtils").getStringValue,g=t("../libraries/ImportUtils").getFloatValue,m=t("../libraries/ImportUtils").getBooleanValue,v=t("../controllers/Exporter").createChildNode,f=t("../controllers/Exporter").createTextElement},{"../controllers/Exporter":1,"../libraries/Constants":29,"../libraries/Context":30,"../libraries/ImportUtils":34,"../libraries/math/MathUtils":48,"../libraries/math/Transform":50,"../libraries/math/Vector":51,"./IPort":56,"./OPort":57}],55:[function(t,e,s){var i=t("../libraries/Constants").DEFAULT_BORDER_COLOR,r=t("../libraries/Constants").DEFAULT_FILL_COLOR,o=t("../libraries/Constants").IO_PORT_BORDER_WIDTH,n=t("../libraries/Constants").IO_PORT_LINE_WIDTH,a=t("../libraries/Constants").IO_PORT_RADIUS,h=t("../libraries/Constants").IO_PORT_LENGTH;e.exports=class{constructor(t,e){this.isOn=!1,this.parent=t,this.connections=[],this.lineColor=i,this.origin=c(0,0),this.target=e.scale(h),this.dir=e,this.set=!1,void 0!=t&&this.updatePosition()}getArray(){}getIndex(){for(var t=0;t<this.getArray().length&&this.getArray()[t]!==this;t++);return t}getCol(){return this.parent.selected||this.selected?"#1cff3e":void 0}getBorderColor(){return this.parent.selected||this.selected?"#0d7f1f":void 0}updatePosition(){var t=this.getIndex(),e=-this.parent.transform.size.y/2*(t-this.getArray().length/2+.5);0===t&&(e-=1),t===this.getArray().length-1&&(e+=1),this.origin.y=e,this.target.y=e,this.prevParentLength=this.getArray().length}onTransformChange(){this.set||this.updatePosition();for(var t=0;t<this.connections.length;t++)void 0!=this.connections[t]&&this.connections[t].onTransformChange()}activate(t){}contains(t){var e=new l(this.target,c(a,a).scale(2),0,this.parent.context.getCamera());return e.setParent(this.parent.transform),d(e,t)}sContains(t){if(this.origin.y!==this.target.y)return!1;var e=Math.abs(this.target.x-this.origin.x),s=this.target.add(this.origin).scale(.5),i=new l(s,c(e,2*n),0,this.parent.context.getCamera());return i.setParent(this.parent.transform),u(i,t)}draw(){this.set||this.getArray().length===this.prevParentLength||this.updatePosition();var t=this.origin,e=this.target,s=this.parent.getRenderer(),h=this.parent.getBorderColor()?this.parent.getBorderColor():this.lineColor;s.line(t.x,t.y,e.x,e.y,h,n);var c=this.getCol()?this.getCol():r,l=this.getBorderColor()?this.getBorderColor():i;s.circle(e.x,e.y,a,c,l,o)}remove(){}setOrigin(t){this.origin.x=t.x,this.origin.y=t.y,this.set=!0,void 0!=this.parent&&this.parent.onTransformChange()}setTarget(t){this.target.x=t.x,this.target.y=t.y,this.set=!0,void 0!=this.parent&&this.parent.onTransformChange()}getPos(){return this.parent.transform.getMatrix().mul(this.target)}getOPos(){return this.parent.transform.getMatrix().mul(this.origin)}getDir(){return this.parent.transform.getMatrix().mul(this.dir).sub(this.parent.getPos()).normalize()}get uid(){return this.parent.uid}setName(t){}setPos(){}getInputAmount(){return 1}getMaxInputFieldCount(){return 1}getMinInputFieldCount(){return 1}getName(){return this.getDisplayName()}getDisplayName(){return"ioport"}getXMLName(){return this.getDisplayName().toLowerCase().replace(/\s+/g,"")}copy(){var t=new this.constructor;return t.origin=this.origin.copy(),t.target=this.target.copy(),t.set=this.set,t.lineColor=this.lineColor,t}writeTo(t){var e=g(t,this.getXMLName());m(e,"originx",this.origin.x),m(e,"originy",this.origin.y),m(e,"targetx",this.target.x),m(e,"targety",this.target.y)}load(t){var e=p(getChildNode(t,"originx")),s=p(getChildNode(t,"originy")),i=p(getChildNode(t,"targetx")),r=p(getChildNode(t,"targety"));return this.setOrigin(c(e,s)),this.setTarget(c(i,r)),this}};var c=t("../libraries/math/Vector").V,l=t("../libraries/math/Transform"),u=t("../libraries/math/MathUtils").RectContains,d=t("../libraries/math/MathUtils").CircleContains,p=t("../libraries/ImportUtils").getFloatValue,g=t("../controllers/Exporter").createChildNode,m=t("../controllers/Exporter").createTextElement},{"../controllers/Exporter":1,"../libraries/Constants":29,"../libraries/ImportUtils":34,"../libraries/math/MathUtils":48,"../libraries/math/Transform":50,"../libraries/math/Vector":51}],56:[function(t,e,s){var i=t("./IOPort");e.exports=class extends i{constructor(t){super(t,r(-1,0))}getArray(){return this.parent.inputs}set input(t){void 0==t?this.connections=[]:this.connections[0]=t}get input(){return this.connections.length>0?this.connections[0]:void 0}activate(t){this.isOn!==t&&(this.isOn=t,this.parent.context.propogate(this,this.parent,this.isOn))}remove(){void 0!=this.input&&this.input.disconnect(this)}getDisplayName(){return"iport"}};var r=t("../libraries/math/Vector").V},{"../libraries/math/Vector":51,"./IOPort":55}],57:[function(t,e,s){var i=t("./IOPort");e.exports=class extends i{constructor(t){super(t,r(1,0))}getArray(){return this.parent.outputs}activate(t){if(this.isOn!==t){this.isOn=t;for(var e=0;e<this.connections.length;e++)this.parent.context.propogate(this,this.connections[e],this.isOn)}}remove(){for(var t=0;t<this.connections.length;t++)this.disconnect(this.connections[t])}connect(t){return this.connections.push(t),t.input=this,t.onTransformChange(),t.activate(this.isOn),!0}disconnect(t){for(var e=0;e<this.connections.length&&this.connections[e]!==t;e++);this.connections[e].input=void 0,this.connections.splice(e,1)}getDisplayName(){return"oport"}};var r=t("../libraries/math/Vector").V},{"../libraries/math/Vector":51,"./IOPort":55}],58:[function(t,e,s){var i=t("../libraries/Constants").DEFAULT_SIZE,r=t("../libraries/Constants").DEFAULT_FILL_COLOR;class o{constructor(t){this.context=t,this.input=void 0,this.connection=void 0,this.curve=new c(a(0,0),a(0,0),a(0,0),a(0,0)),this.isOn=!1,this.set=!1,this.straight=!1,this.dirty=!0,this.boundingBox=new h(0,0,0,t.getCamera())}activate(t){this.isOn!==t&&(this.isOn=t,void 0!=this.connection&&this.connection.activate(t))}split(t){var e=this.curve.getPos(t),s=new o(this.context),i=this.connection;this.disconnect();var r=new l(this.context);this.connect(r),s.connect(i),r.connect(s),this.connection.setPos(e),getCurrentContext().addObject(r),getCurrentContext().addWire(s)}updateBoundingBox(){if(this.dirty){this.dirty=!1;var t=this.getPos(0),e=this.getPos(1),s=a(Math.min(t.x,e.x),Math.min(t.y,e.y)),i=a(Math.max(t.x,e.x),Math.max(t.y,e.y));this.boundingBox.setSize(a(i.x-s.x+2,i.y-s.y+2)),this.boundingBox.setPos(a((i.x-s.x)/2+s.x,(i.y-s.y)/2+s.y))}}onTransformChange(){if(void 0!=this.input){var t=this.input.getPos();if(this.set)this.curve.c1.x+=t.x-this.curve.p1.x,this.curve.c1.y+=t.y-this.curve.p1.y;else{var e=(this.input instanceof l?this.input.getODir():this.input.getDir()).scale(i).add(t);this.curve.c1.x=e.x,this.curve.c1.y=e.y}this.curve.p1.x=t.x,this.curve.p1.y=t.y,this.curve.dirty=!0,this.dirty=!0}if(void 0!=this.connection){t=this.connection.getPos();if(this.set)this.curve.c2.x+=t.x-this.curve.p2.x,this.curve.c2.y+=t.y-this.curve.p2.y;else{e=this.connection.getDir().scale(i).add(t);this.curve.c2.x=e.x,this.curve.c2.y=e.y}this.curve.p2.x=t.x,this.curve.p2.y=t.y,this.curve.dirty=!0,this.dirty=!0}}connect(t){return void 0==this.connection&&void 0==t.input&&(this.connection=t,t.input=this,this.onTransformChange(),t.activate(this.isOn),!0)}disconnect(){if(void 0==this.connection)return!1;this.connection.input=void 0,this.connection.activate(!1),this.connection=void 0}draw(){var t=this.context.getRenderer(),e=this.context.getCamera(),s=this.isOn?"#3cacf2":this.selected?"#1cff3e":r;if(this.straight){var i=e.getScreenPos(this.curve.p1),o=e.getScreenPos(this.curve.p2);t.line(i.x,i.y,o.x,o.y,s,7/e.zoom)}else this.curve.draw(s,7/e.zoom,t)}remove(){this.context.remove(this),void 0!=this.input&&this.input.disconnect(this),void 0!=this.connection&&this.disconnect(this.connection)}contains(t){return-1!==this.curve.getNearestT(t.x,t.y)}setName(t){}setPos(){}getPos(t){return void 0==t&&(t=.5),this.curve.getPos(t)}getNearestT(t,e){return this.straight?getNearestT(this.curve.p1,this.curve.p2,t,e):this.curve.getNearestT(t,e)}getCullBox(){return this.straight?this.getBoundingBox():this.curve.getBoundingBox()}getBoundingBox(){if(this.straight)return this.updateBoundingBox(),this.boundingBox}getInputAmount(){return 1}getMaxInputFieldCount(){return 1}getMinInputFieldCount(){return 1}getName(){return this.getDisplayName()}getDisplayName(){return"Wire"}copy(){var t=new o(this.context);return t.curve=this.curve.copy(),t.straight=this.straight,t}writeTo(t,e,s){var i=g(t,"wire");m(i,"uid",this.uid);var r=g(i,"input");m(r,"uid",this.input.uid),m(r,"index",this.input.getIndex());var o=g(i,"connection");m(o,"uid",this.connection.uid),m(o,"index",this.connection.getIndex()),this.curve.writeTo(i),m(i,"straight",this.straight)}load(t){this.context.getObjects(),this.context.getWires();var e=d(u(t,"uid"));this.uid=e;var s=u(t,"bezier");this.curve.load(s);var i=p(u(t,"straight"));return this.straight=i,this}loadConnections(t,e){var s=u(t,"input"),i=d(u(s,"uid")),r=d(u(s,"index")),o=n(e,i);o=o instanceof l?o:o.outputs[r];var a=u(t,"connection"),h=d(u(a,"uid")),c=d(u(a,"index")),p=n(e,h);console.log(h),console.log(c),console.log(p),p=p instanceof l?p:p.inputs[c],o.connect(this),this.connect(p)}}function n(t,e){for(var s=0;s<t.length;s++)if(t[s].uid===e)return t[s]}e.exports=o;var a=t("../libraries/math/Vector").V,h=t("../libraries/math/Transform"),c=t("../libraries/math/Bezier"),l=t("./WirePort"),u=t("../libraries/ImportUtils").getChildNode,d=t("../libraries/ImportUtils").getIntValue,p=(t("../libraries/ImportUtils").getStringValue,t("../libraries/ImportUtils").getFloatValue,t("../libraries/ImportUtils").getBooleanValue),g=t("../controllers/Exporter").createChildNode,m=t("../controllers/Exporter").createTextElement},{"../controllers/Exporter":1,"../libraries/Constants":29,"../libraries/ImportUtils":34,"../libraries/math/Bezier":47,"../libraries/math/Transform":50,"../libraries/math/Vector":51,"./WirePort":59}],59:[function(t,e,s){var i=t("../libraries/Constants").DEFAULT_BORDER_COLOR,r=t("../libraries/Constants").WIRE_SNAP_THRESHOLD,o=t("./IOObject");class n extends o{constructor(t){super(t,0,0,2*i,2*i),this._input=void 0,this.connection=void 0,this.isOn=!1,this.selected=!1,this.hasSetTransform=!1}set input(t){this._input=t,this.hasSetTransform||(this.hasSetTransform=!0,this.transform=new c(t.curve.p2.copy(),h(15,15),0,this.context.getCamera()))}get input(){return this._input}activate(t){this.isOn!==t&&(this.isOn=t,void 0!=this.connection&&this.connection.activate(t))}remove(){this.context.remove(this),void 0!=this.input&&this.input.disconnect(this),void 0!=this.connection&&this.disconnect(this.connection)}onTransformChange(){void 0!=this.input&&this.input.onTransformChange(),void 0!=this.connection&&this.connection.onTransformChange()}connect(t){return void 0==this.connection&&(this.connection=t,t.input=this,t.onTransformChange(),t.activate(this.isOn),!0)}disconnect(){void 0!=this.connection&&(this.connection.input=void 0,this.connection=void 0)}draw(){var t=this.context.getRenderer(),e=this.context.getCamera(),s=e.getScreenPos(this.getPos());t.circle(s.x,s.y,7/e.zoom,this.selected?"#1cff3e":"#ffffff",this.selected?"#0d7f1f":"#000000",1/e.zoom)}contains(t){return l(this.transform,t)}sContains(t){return this.contains(t)}setPos(t){void 0!=this.input&&void 0!=this.connection&&(this.input.straight=!1,this.connection.straight=!1,t.x=a(this.input,t.x,this.input.curve.p1.x),t.y=a(this.input,t.y,this.input.curve.p1.y),t.x=a(this.connection,t.x,this.connection.curve.p2.x),t.y=a(this.connection,t.y,this.connection.curve.p2.y)),super.setPos(t)}getIndex(){return 0}getDir(){return this.transform.getMatrix().mul(h(-1,0)).sub(this.transform.pos).normalize()}getODir(){return this.transform.getMatrix().mul(h(1,0)).sub(this.transform.pos).normalize()}getCullBox(){return this.transform}getInputAmount(){return 1}getName(){return this.getDisplayName()}getDisplayName(){return"Port"}}function a(t,e,s){return Math.abs(e-s)<=r?(t.straight=!0,s):e}n.getXMLName=function(){return"port"},e.exports=n;var h=t("../libraries/math/Vector").V,c=t("../libraries/math/Transform"),l=t("../libraries/math/MathUtils").CircleContains},{"../libraries/Constants":29,"../libraries/math/MathUtils":48,"../libraries/math/Transform":50,"../libraries/math/Vector":51,"./IOObject":54}],60:[function(t,e,s){var i=t("../../libraries/Constants").DEFAULT_SIZE,r=t("../IOObject");e.exports=class extends r{constructor(t,e,s,r,o){super(t,s,r,i*(void 0!=o?o.ratio:1),i,o,!1,512,512),this._not=!!e,this.name=this.getDisplayName(),this.setInputAmount(2)}set not(t){this._not=t,t&&(this.outputs[0].isOn=!this.isOn)}get not(){return this._not}activate(t,e){super.activate(this.not?!t:t,e)}draw(){super.draw();var t=this.context.getRenderer();if(this.localSpace(),this.not){var e=this.transform.size.x/2+5;t.circle(e,0,5,void 0==this.getCol()?"#fff":this.getCol(),this.getBorderColor(),2)}t.restore()}getDisplayName(){return"Gate"}copy(){var t=super.copy();return t.not=this.not,t}writeTo(t){var e=super.writeTo(t);return h(e,"not",this.not),h(e,"inputcount",this.getInputAmount()),e}load(t){super.load(t);var e=n(a(t,"not")),s=o(a(t,"inputcount"),1);return this.not=e,this.setInputAmount(s),this}};t("../../libraries/Images");var o=t("../../libraries/ImportUtils").getIntValue,n=t("../../libraries/ImportUtils").getBooleanValue,a=t("../../libraries/ImportUtils").getChildNode,h=t("../../controllers/Exporter").createTextElement},{"../../controllers/Exporter":1,"../../libraries/Constants":29,"../../libraries/Images":33,"../../libraries/ImportUtils":34,"../IOObject":54}],61:[function(t,e,s){var i=t("../../../libraries/Constants").DEFAULT_SIZE,r=t("../Gate");class o extends r{constructor(t,e,s){super(t,!1,e,s,void 0),this.noChange=!0,this.setInputAmount(3),this.setOutputAmount(2),this.transform.setSize(this.transform.size.scale(1.5))}onTransformChange(){this.transform.setSize(n(i,i)),super.onTransformChange(),this.transform.setSize(n(1.5*i,1.5*i))}activate(t){var e=this.outputs[0].isOn,s=this.inputs[0].isOn,i=this.inputs[1].isOn,r=this.inputs[2].isOn;i&&(s&&r||(s?e=!0:r&&(e=!1))),super.activate(e,0),super.activate(!e,1)}draw(){super.draw();var t=this.context.getRenderer();this.localSpace(),t.rect(0,0,this.transform.size.x,this.transform.size.y,this.getCol(),this.getBorderColor()),t.restore()}getDisplayName(){return"SR Flip Flop"}}o.getXMLName=function(){return"srff"},e.exports=o;var n=t("../../../libraries/math/Vector").V},{"../../../libraries/Constants":29,"../../../libraries/math/Vector":51,"../Gate":60}],62:[function(t,e,s){var i=t("../Gate");class r extends i{constructor(t,e,s,i){super(t,e,s,i,n["and.svg"])}setInputAmount(t){super.setInputAmount(t);for(var e=0;e<this.inputs.length;e++){var s=this.inputs[e];s.origin=o(-(this.transform.size.x-2)/2,s.origin.y)}}activate(t){for(var e=!0,s=0;s<this.inputs.length;s++)e=e&&this.inputs[s].isOn;super.activate(e)}draw(){var t=this.context.getRenderer();this.localSpace();var e=-this.transform.size.y/2*(.5-this.inputs.length/2),s=-this.transform.size.y/2*(this.inputs.length/2-.5),i=(this.transform.size.x-2)/2,r=o(-i,e),n=o(-i,s);t.line(r.x,r.y,n.x,n.y,this.getBorderColor(),2),t.restore(),super.draw()}getDisplayName(){return this.not?"NAND Gate":"AND Gate"}}r.getXMLName=function(){return"andgate"},e.exports=r;var o=t("../../../libraries/math/Vector").V,n=t("../../../libraries/Images")},{"../../../libraries/Images":33,"../../../libraries/math/Vector":51,"../Gate":60}],63:[function(t,e,s){var i=t("../Gate");class r extends i{constructor(t,e,s,i){super(t,e,s,i,o["buffer.svg"]),this.maxInputs=1,this.setInputAmount(1),this.activate(!1)}activate(t){for(var e=!1,s=0;s<this.inputs.length;s++)e=this.inputs[s].isOn;super.activate(e)}getDisplayName(){return this.not?"NOT Gate":"Buffer Gate"}}r.getXMLName=function(){return"bufgate"},e.exports=r;var o=t("../../../libraries/Images")},{"../../../libraries/Images":33,"../Gate":60}],64:[function(t,e,s){var i=t("../Gate");class r extends i{constructor(t,e,s,i){super(t,e,s,i,n["or.svg"])}quadCurveXAt(t){var e=this.transform.size.x/2-2,s=1-t;return s*s*-e+2*t*s*-(this.transform.size.x/5-2)+t*t*-e}setInputAmount(t){super.setInputAmount(t);for(var e=0;e<this.inputs.length;e++){var s=this.inputs[e],i=(s.origin.y/this.transform.size.y+.5)%1;i<0&&(i+=1);var r=this.quadCurveXAt(i);s.origin=o(r,s.origin.y)}}activate(t){for(var e=!1,s=0;s<this.inputs.length;s++)e=e||this.inputs[s].isOn;super.activate(e)}draw(){var t=this.context.getRenderer();this.localSpace();for(var e=2*Math.floor(this.inputs.length/4)+1,s=0;s<e;s++){var i=(s-Math.floor(e/2))*this.transform.size.y,r=-this.transform.size.y/2,n=+this.transform.size.y/2,a=this.transform.size.x/2-2,h=this.transform.size.x/5-2,c=o(-a,r+i),l=o(-a,n+i),u=o(-h,i);t.quadCurve(c.x,c.y,l.x,l.y,u.x,u.y,this.getBorderColor(),2)}t.restore(),super.draw()}getDisplayName(){return this.not?"NOR Gate":"OR Gate"}}r.getXMLName=function(){return"orgate"},e.exports=r;var o=t("../../../libraries/math/Vector").V,n=t("../../../libraries/Images")},{"../../../libraries/Images":33,"../../../libraries/math/Vector":51,"../Gate":60}],65:[function(t,e,s){var i=t("../Gate");class r extends i{constructor(t,e,s,i){super(t,e,s,i,n["or.svg"])}quadCurveXAt(t){var e=this.transform.size.x/2-2,s=1-t;return s*s*-e+2*t*s*-(this.transform.size.x/5-2)+t*t*-e}setInputAmount(t){super.setInputAmount(t);for(var e=0;e<this.inputs.length;e++){var s=this.inputs[e],i=(s.origin.y/this.transform.size.y+.5)%1;i<0&&(i+=1);var r=this.quadCurveXAt(i);s.origin=o(r,s.origin.y)}}activate(t){for(var e=!1,s=0;s<this.inputs.length;s++)e=e!==this.inputs[s].isOn;super.activate(e)}draw(){super.draw();var t=this.context.getRenderer();this.localSpace();for(var e=2*Math.floor(this.inputs.length/4)+1,s=0;s<e;s++){var i=(s-Math.floor(e/2))*this.transform.size.y,r=-this.transform.size.y/2,n=+this.transform.size.y/2,a=this.transform.size.x/2-2,h=this.transform.size.x/5-2,c=o(-a,r+i),l=o(-a,n+i),u=o(-h,i);t.quadCurve(c.x,c.y,l.x,l.y,u.x,u.y,this.getBorderColor(),2),t.quadCurve(c.x-12,c.y,l.x-12,l.y,u.x-12,u.y,this.getBorderColor(),2)}t.restore()}getDisplayName(){return this.not?"XNOR Gate":"XOR Gate"}getXMLName(){return"xorgate"}}r.getXMLName=function(){return"xorgate"},e.exports=r;var o=t("../../../libraries/math/Vector").V,n=t("../../../libraries/Images")},{"../../../libraries/Images":33,"../../../libraries/math/Vector":51,"../Gate":60}],66:[function(t,e,s){var i=t("../../../libraries/Constants").DEFAULT_SIZE,r=t("../../IOObject");class o extends r{constructor(t,e,s){super(t,e,s,i,i,n["buttonUp.svg"],!0,0,1,60,60)}press(){super.activate(!0),this.img=n["buttonDown.svg"]}release(){super.activate(!1),this.img=n["buttonUp.svg"]}contains(t){return a(this.transform,t)}getDisplayName(){return"Button"}}o.getXMLName=function(){return"button"},e.exports=o;var n=t("../../../libraries/Images"),a=t("../../../libraries/math/MathUtils").CircleContains},{"../../../libraries/Constants":29,"../../../libraries/Images":33,"../../../libraries/math/MathUtils":48,"../../IOObject":54}],67:[function(t,e,s){var i=t("../../IOObject");class r extends i{constructor(t,e,s){super(t,e,s,60,60/o["clock.svg"].ratio,o["clock.svg"],!1,0,1),this.frequency=1e3,setTimeout(()=>this.tick(),this.frequency)}tick(){this.activate(!this.isOn),setTimeout(()=>this.tick(),this.frequency)}activate(t){super.activate(t),this.img=t?o["clockOn.svg"]:o["clock.svg"],render()}getDisplayName(){return"Clock"}}r.getXMLName=function(){return"clock"},e.exports=r;var o=t("../../../libraries/Images")},{"../../../libraries/Images":33,"../../IOObject":54}],68:[function(t,e,s){var i=t("../../../libraries/Constants").DEFAULT_SIZE,r=t("../../IOObject");class o extends r{constructor(t,e,s){super(t,e,s,i,i,n["constHigh.svg"],!1,0,1),super.activate(!0)}getDisplayName(){return"Constant High"}}o.getXMLName=function(){return"consthigh"},e.exports=o;var n=t("../../../libraries/Images")},{"../../../libraries/Constants":29,"../../../libraries/Images":33,"../../IOObject":54}],69:[function(t,e,s){var i=t("../../../libraries/Constants").DEFAULT_SIZE,r=t("../../IOObject");class o extends r{constructor(t,e,s){super(t,e,s,i,i,n["constLow.svg"],!1,0,1),super.activate(!1)}getDisplayName(){return"Constant Low"}}o.getXMLName=function(){return"constlow"},e.exports=o;var n=t("../../../libraries/Images")},{"../../../libraries/Constants":29,"../../../libraries/Images":33,"../../IOObject":54}],70:[function(t,e,s){var i=t("../../../libraries/Constants").DEFAULT_SIZE,r=t("../../IOObject");class o extends r{constructor(t,e,s){super(t,e,s,3.5*i,3.5*i/h["keyboard.svg"].ratio,h["keyboard.svg"],!1,0,7),this.setOutputAmount(7);for(var r=0;r<7;r++){var o=this.outputs[r],n=-i/2*(r-3.5+.5);0===r&&(n-=1),6===r&&(n+=1),o.setOrigin(a(n,0)),o.setTarget(a(n,-IO_PORT_LENGTH-(this.transform.size.y-i)/2)),o.dir=a(0,-1)}}onKeyDown(t){if(void 0!=(t=o.codeMap[t])){this.activate(!0,this.outputs.length-1);for(var e=this.outputs.length-2;e>=0;e--){var s=1<<e;s>t?this.outputs[e].activate(!1):(this.outputs[e].activate(!0),t-=s)}}}onKeyUp(t){if(void 0!=(t=o.codeMap[t])){this.activate(!1,this.outputs.length-1);for(var e=this.outputs.length-2;e>=0;e--)this.outputs[e].activate(!1)}}getDisplayName(){return"Keyboard"}}o.getXMLName=function(){return"keyboard"},o.codeMap=[],o.codeCount=0,o.addKey=function(t){o.codeMap[t]=++o.codeCount};for(var n=48;n<=57;n++)o.addKey(n);for(n=65;n<=90;n++)o.addKey(n);o.addKey(32),o.addKey(13),o.addKey(8),o.addKey(9),o.addKey(16),o.addKey(17),o.addKey(18),o.addKey(91),o.addKey(20),o.addKey(27),o.addKey(192),o.addKey(189),o.addKey(187),o.addKey(219),o.addKey(221),o.addKey(220),o.addKey(186),o.addKey(222),o.addKey(188),o.addKey(190),o.addKey(191),o.addKey(37),o.addKey(38),o.addKey(39),o.addKey(40),o.addKey(112),o.addKey(112),e.exports=o;var a=t("../../../libraries/math/Vector").V,h=t("../../../libraries/Images")},{"../../../libraries/Constants":29,"../../../libraries/Images":33,"../../../libraries/math/Vector":51,"../../IOObject":54}],71:[function(t,e,s){t("../../../libraries/Constants").DEFAULT_SIZE;var i=t("../../IOObject");class r extends i{constructor(t,e,s){super(t,e,s,60*o["switchUp.svg"].ratio,60,o["switchUp.svg"],!0,0,1,77*o["switchUp.svg"].ratio,77)}activate(t){super.activate(t),this.img=o[this.isOn?"switchDown.svg":"switchUp.svg"]}click(){super.click(),this.activate(!this.isOn)}getDisplayName(){return"Switch"}writeTo(t){var e=super.writeTo(t);return n(e,"isOn",this.outputs[0].isOn),e}}r.getXMLName=function(){return"switch"},e.exports=r;var o=t("../../../libraries/Images"),n=t("../../../controllers/Exporter").createTextElement},{"../../../controllers/Exporter":1,"../../../libraries/Constants":29,"../../../libraries/Images":33,"../../IOObject":54}],72:[function(t,e,s){var i=t("../../../libraries/Constants").DEFAULT_SIZE,r=t("../Gate");class o extends r{constructor(t,e,s){super(t,!1,e,s,void 0)}onTransformChange(){this.transform.setSize(n(i,i)),super.onTransformChange(),this.transform.setSize(n(i,i/2*(2<<this.inputs.length-1)))}setInputAmount(t){t=a(t,0,8),super.setInputAmount(t),super.setOutputAmount(2<<t-1)}getInputAmount(){return this.inputs.length}activate(t){for(var e=0,s=0;s<this.inputs.length;s++)e|=(this.inputs[s].isOn?1:0)<<s;for(s=0;s<this.outputs.length;s++)this.outputs[s].activate(s===e,s)}draw(){super.draw();var t=this.context.getRenderer();this.localSpace(),t.rect(0,0,this.transform.size.x,this.transform.size.y,this.getCol(),this.getBorderColor()),t.restore()}getMinInputFieldCount(){return 1}getDisplayName(){return"Decoder"}}o.getXMLName=function(){return"decoder"},e.exports=o;var n=t("../../../libraries/math/Vector").V,a=t("../../../libraries/math/MathUtils").Clamp},{"../../../libraries/Constants":29,"../../../libraries/math/MathUtils":48,"../../../libraries/math/Vector":51,"../Gate":60}],73:[function(t,e,s){var i=t("../../../libraries/Constants").DEFAULT_SIZE,r=t("../../../libraries/Constants").IO_PORT_LENGTH,o=t("../Gate");class n extends o{constructor(t,e,s){super(t,!1,e,s,void 0)}setInputAmount(t){super.setInputAmount(t+1),super.setOutputAmount(2<<t-1);var e=Math.max(i/2*(t-1),i),s=i/2*(2<<t-1);this.transform.setSize(a(e+10,s)),this.selectLines=[];for(var o=0;o<t;o++){var n=this.inputs[o];this.selectLines.push(n);var h=-i/2*(o-t/2+.5);0===o&&(h-=1),o===t-1&&(h+=1),n.setOrigin(a(h,0)),n.setTarget(a(h,r+s/2-i/2))}for(o=0;o<this.outputs.length;o++){var c=this.outputs[o];h=-i/2*(o-this.outputs.length/2+.5);0===o&&(h-=1),o===this.outputs.length-1&&(h+=1),c.setOrigin(a(0,h)),c.setTarget(a(r+(e/2-i/2),h))}(n=this.inputs[this.inputs.length-1]).setOrigin(a(0,0)),n.setTarget(a(-r-(e/2-i/2),0))}getInputAmount(){return this.selectLines.length}activate(t){for(var e=0,s=0;s<this.selectLines.length;s++)e|=(this.selectLines[s].isOn?1:0)<<s;super.activate(this.inputs[this.inputs.length-1].isOn,e)}draw(){super.draw();var t=this.context.getRenderer();this.localSpace();var e=a(this.transform.size.x/2,this.transform.size.y/2),s=a(this.transform.size.x/2,-this.transform.size.y/2),i=a(-this.transform.size.x/2,-this.transform.size.y/2+20),r=a(-this.transform.size.x/2,this.transform.size.y/2-20);t.shape([e,s,i,r],this.getCol(),this.getBorderColor(),2),t.restore()}getMinInputFieldCount(){return 1}getDisplayName(){return"Demultiplexer"}}n.getXMLName=function(){return"demux"},e.exports=n;var a=t("../../../libraries/math/Vector").V},{"../../../libraries/Constants":29,"../../../libraries/math/Vector":51,"../Gate":60}],74:[function(t,e,s){var i=t("../../../libraries/Constants").DEFAULT_SIZE,r=t("../Gate");class o extends r{constructor(t,e,s){super(t,!1,e,s,void 0)}onTransformChange(){this.transform.setSize(n(i,i)),super.onTransformChange(),this.transform.setSize(n(i,i/2*(2<<this.outputs.length-1)))}setInputAmount(t){t=a(t,0,8),super.setInputAmount(2<<t-1),super.setOutputAmount(t)}getInputAmount(){return this.outputs.length}activate(t){for(var e=-1,s=0;s<this.inputs.length;s++)if(this.inputs[s].isOn){if(-1!==e)return;e=s}if(-1!==e)for(s=this.outputs.length-1;s>=0;s--){var i=1<<s;i>e?this.outputs[s].activate(!1):(this.outputs[s].activate(!0),e-=i)}}draw(){super.draw();var t=this.context.getRenderer();this.localSpace(),t.rect(0,0,this.transform.size.x,this.transform.size.y,this.getCol(),this.getBorderColor()),t.restore()}getMinInputFieldCount(){return 1}getDisplayName(){return"Encoder"}}o.getXMLName=function(){return"encoder"},e.exports=o;var n=t("../../../libraries/math/Vector").V,a=t("../../../libraries/math/MathUtils").Clamp},{"../../../libraries/Constants":29,"../../../libraries/math/MathUtils":48,"../../../libraries/math/Vector":51,"../Gate":60}],75:[function(t,e,s){t("../../../libraries/Constants").DEFAULT_SIZE;var i=t("../../IOObject");class r extends i{constructor(t,e,s,i){super(t,s,i,50,50,void 0,!1,999,999),this.data=e,this.setup()}setup(){if(void 0!=this.data){this.setInputAmount(this.data.getInputAmount()),this.setOutputAmount(this.data.getOutputAmount());var t=this.data.copy();this.inputObjects=t.inputs,this.outputObjects=t.outputs,this.components=t.components;for(var e=0;e<this.outputObjects.length;e++){var s=this.outputs[e];this.outputObjects[e].activate=function(t){s.activate(t)}}this.noChange=!0,this.update()}}update(){if(void 0!=this.data){this.transform.setWidth(this.data.getWidth()),this.transform.setHeight(this.data.getHeight());for(var t=0;t<this.inputs.length;t++)this.inputs[t].setOrigin(this.data.iports[t].origin),this.inputs[t].setTarget(this.data.iports[t].target);for(t=0;t<this.outputs.length;t++)this.outputs[t].setOrigin(this.data.oports[t].origin),this.outputs[t].setTarget(this.data.oports[t].target);this.activate()}}activate(){for(var t=0;t<this.inputs.length;t++)this.inputObjects[t].activate(this.inputs[t].isOn)}draw(){var t=this.context.getRenderer();super.draw(),this.localSpace();var e=this.transform.size;t.rect(0,0,e.x,e.y,this.getCol(),"#000000",1);for(var s=0;s<this.inputs.length;s++){var i=this.inputObjects[s].getName(),r=this.transform.toLocalSpace(this.inputs[s].getPos()),n="center",a=8,h=t.getTextWidth(i)/2;(c=(c=getNearestPointOnRect(V(-e.x/2,-e.y/2),V(e.x/2,e.y/2),r)).sub(r).normalize().scale(a).add(c)).x=o(c.x,-e.x/2+a+h,e.x/2-a-h),c.y=o(c.y,-e.y/2+14,e.y/2-14),t.text(i,c.x,c.y,0,0,n)}for(s=0;s<this.outputs.length;s++){var c;i=this.outputObjects[s].getName(),r=this.transform.toLocalSpace(this.outputs[s].getPos()),n="center",a=8,h=t.getTextWidth(i)/2;(c=(c=getNearestPointOnRect(V(-e.x/2,-e.y/2),V(e.x/2,e.y/2),r)).sub(r).normalize().scale(a).add(c)).x=o(c.x,-e.x/2+a+h,e.x/2-a-h),c.y=o(c.y,-e.y/2+14,e.y/2-14),t.text(i,c.x,c.y,0,0,n)}t.restore()}getDisplayName(){return"IC"}copy(){return new r(this.context,this.data,this.transform.pos.x,this.transform.pos.y)}writeTo(t){var e=super.writeTo(t);return c(e,"icuid",this.data.getUID()),e}load(t,e){super.load(t);var s=a(h(t,"icuid")),i=n(s,e);return this.data=i,this.setup(),this}}r.getXMLName=function(){return"ic"},e.exports=r;var o=t("../../../libraries/math/MathUtils").Clamp,n=t("../../../libraries/ObjectUtils").FindIC,a=t("../../../libraries/ImportUtils").getIntValue,h=t("../../../libraries/ImportUtils").getChildNode,c=t("../../../controllers/Exporter").createTextElement},{"../../../controllers/Exporter":1,"../../../libraries/Constants":29,"../../../libraries/ImportUtils":34,"../../../libraries/ObjectUtils":35,"../../../libraries/math/MathUtils":48,"../../IOObject":54}],76:[function(t,e,s){var i=t("../../../libraries/Constants").DEFAULT_SIZE,r=t("../../../libraries/Constants").IO_PORT_LENGTH;t("../../IOObject");class o{constructor(t,e,s){this.transform=new a(n(0,0),n(0,0),0),this.inputs=t,this.outputs=e,this.components=s,this.wires=l(this.getObjects()),this.uidmanager=new g(this);for(var o=this.getObjects(),u=0;u<o.length;u++)this.uidmanager.giveUIDTo(o[u]);for(u=0;u<this.wires.length;u++)this.uidmanager.giveUIDTo(this.wires[u]);var d=0;for(u=0;u<this.inputs.length;u++)d=Math.max(this.inputs[u].getName().length,d);for(u=0;u<this.outputs.length;u++)d=Math.max(this.outputs[u].getName().length,d);var p=i+20*d,m=i/2*Math.max(this.inputs.length,this.outputs.length);this.transform.setSize(n(p,m)),this.iports=[],this.oports=[];for(u=0;u<this.inputs.length;u++){this.iports[u]=new h;var v=-i/2*(u-this.inputs.length/2+.5);0===u&&(v-=1),u===this.inputs.length-1&&(v+=1),this.iports[u].setOrigin(n(0,v)),this.iports[u].setTarget(n(-r-(p/2-i/2),v))}for(u=0;u<this.outputs.length;u++){this.oports[u]=new c;v=-i/2*(u-this.outputs.length/2+.5);0===u&&(v-=1),u===this.outputs.length-1&&(v+=1),this.oports[u].setOrigin(n(0,v)),this.oports[u].setTarget(n(r+(p/2-i/2),v))}this.recalculatePorts()}recalculatePorts(){for(var t=this.transform.size,e=this.iports,s=0;s<e.length;s++){var i=e[s],o=this.transform.getMatrix().mul(i.target),a=this.transform.getMatrix().mul(i.origin),h=o.add(o.sub(a).normalize().scale(1e4)),c=(p=u(n(-t.x/2,-t.y/2),n(t.x/2,t.y/2),h)).sub(h).normalize().scale(t.scale(.5)).add(p),l=p.sub(h).normalize().scale(t.scale(.5).sub(n(r+t.x/2-25,r+t.y/2-25))).add(p);i.setOrigin(c),i.setTarget(l)}var d=this.oports;for(s=0;s<d.length;s++){var p,g=d[s];o=this.transform.getMatrix().mul(g.target),a=this.transform.getMatrix().mul(g.origin),h=o.add(o.sub(a).normalize().scale(1e4)),c=(p=u(n(-t.x/2,-t.y/2),n(t.x/2,t.y/2),h)).sub(h).normalize().scale(t.scale(.5)).add(p),l=p.sub(h).normalize().scale(t.scale(.5).sub(n(r+t.x/2-25,r+t.y/2-25))).add(p);g.setOrigin(c),g.setTarget(l)}}getInputAmount(){return this.inputs.length}getOutputAmount(){return this.outputs.length}copy(){return d(p(this.getObjects()).objects)}getUID(){return this.icuid}getObjects(){return this.inputs.concat(this.components,this.outputs)}getWires(){return this.wires}getWidth(){return this.transform.getSize().x}getHeight(){return this.transform.getSize().y}}o.create=function(t){t=p(t).objects;for(var e=d(t),s=0;s<e.inputs.length;s++){var i=e.inputs[s];i instanceof Clock&&i.getName()===i.getDisplayName()&&i.setName(">")}return new o(e.inputs,e.outputs,e.components)},o.add=function(t){t.icuid=o.ICs.length,o.ICs.push(t)},o.redistributeUIDs=function(){for(var t=[],e=0;e<o.ICs.length;e++)t[e]=o.ICs[e];o.ICs=[];for(e=0;e<t.length;e++)t[e].icuid=e,o.ICs[e]=t[e]},o.ICs=[],e.exports=o;var n=t("../../../libraries/math/Vector").V,a=t("../../../libraries/math/Transform"),h=t("../../IPort"),c=t("../../OPort"),l=(t("../../../libraries/ObjectUtils").FindIC,t("../../../libraries/ObjectUtils").GetAllWires),u=t("../../../libraries/math/MathUtils").GetNearestPointOnRect,d=t("../../../libraries/Utils").SeparateGroup,p=t("../../../libraries/CopyUtils").CopyGroup,g=t("../../../libraries/UIDManager").GetAllWires;t("../../../libraries/ImportUtils").getIntValue,t("../../../libraries/ImportUtils").getChildNode,t("../../../controllers/Exporter").createTextElement},{"../../../controllers/Exporter":1,"../../../libraries/Constants":29,"../../../libraries/CopyUtils":31,"../../../libraries/ImportUtils":34,"../../../libraries/ObjectUtils":35,"../../../libraries/UIDManager":37,"../../../libraries/Utils":38,"../../../libraries/math/MathUtils":48,"../../../libraries/math/Transform":50,"../../../libraries/math/Vector":51,"../../IOObject":54,"../../IPort":56,"../../OPort":57}],77:[function(t,e,s){var i=t("../../IOObject");class r extends i{constructor(t,e,s){super(t,e,s,0,0,void 0,!0,0,0,60,30),this.setName("LABEL"),this.setInputAmount(0),this.setOutputAmount(0)}activate(t){}draw(){super.draw();var t=this.context.getRenderer();this.localSpace();t.getTextWidth(this.text);var e=o(0,0);t.text(this.name,e.x,e.y,0,0,"center"),t.restore()}setName(t){super.setName(t);var e=this.context.getRenderer().getTextWidth(this.name)+20;this.selectionBoxTransform.setSize(o(e,this.selectionBoxTransform.size.y)),this.onTransformChange(),n()}getDisplayName(){return this.name}}r.getXMLName=function(){return"label"},e.exports=r;var o=t("../../../libraries/math/Vector").V,n=t("../../../views/Renderer").render},{"../../../libraries/math/Vector":51,"../../../views/Renderer":82,"../../IOObject":54}],78:[function(t,e,s){var i=t("../../../libraries/Constants").DEFAULT_SIZE,r=t("../../../libraries/Constants").IO_PORT_LENGTH,o=t("../Gate");class n extends o{constructor(t,e,s){super(t,!1,e,s,void 0)}setInputAmount(t){super.setInputAmount(t+(2<<t-1));var e=Math.max(i/2*(t-1),i),s=i/2*(2<<t-1);this.transform.setSize(a(e+10,s)),this.selectLines=[];for(var o=0;o<t;o++){var n=this.inputs[o];this.selectLines.push(n);var h=-i/2*(o-t/2+.5);0===o&&(h-=1),o===t-1&&(h+=1),n.setOrigin(a(h,0)),n.setTarget(a(h,r+s/2-i/2))}for(var c=t;c<this.inputs.length;c++){n=this.inputs[c],h=-i/2*((o=c-t)-(this.inputs.length-t)/2+.5);0===o&&(h-=1),o===this.inputs.length-t-1&&(h+=1),n.setOrigin(a(0,h)),n.setTarget(a(-r-(e/2-i/2),h))}var l=this.outputs[0];l.target=a(r+(e/2-i/2),l.target.y)}getInputAmount(){return this.selectLines.length}activate(t){for(var e=0,s=0;s<this.selectLines.length;s++)e|=(this.selectLines[s].isOn?1:0)<<s;super.activate(this.inputs[e+this.selectLines.length].isOn)}draw(){super.draw();var t=this.context.getRenderer();this.localSpace();var e=a(-this.transform.size.x/2,this.transform.size.y/2),s=a(-this.transform.size.x/2,-this.transform.size.y/2),i=a(this.transform.size.x/2,-this.transform.size.y/2+20),r=a(this.transform.size.x/2,this.transform.size.y/2-20);t.shape([e,s,i,r],this.getCol(),this.getBorderColor(),2),t.restore()}getMinInputFieldCount(){return 1}getDisplayName(){return"Multiplexer"}getXMLName(){return"mux"}}n.getXMLName=function(){return"mux"},e.exports=n;var a=t("../../../libraries/math/Vector").V},{"../../../libraries/Constants":29,"../../../libraries/math/Vector":51,"../Gate":60}],79:[function(t,e,s){var i=t("../../IOObject");class r extends i{constructor(t,e,s){super(t,e,s,70,100,void 0,!1,7,0),this.setInputAmount(7),this.noChange=!0,this.segmentWidth=45,this.segmentHeight=10;for(var i=0;i<7;i++){var r=this.inputs[i],a=-15*(r.getIndex()-r.getArray().length/2+.5);r.setOrigin(o(r.origin.x,a)),r.setTarget(o(r.target.x,a))}this.transform.size.x,this.transform.size.y;var h=this.segmentWidth,c=this.segmentHeight;this.segmentPositions=[o(0,-h+c),o(h/2-c/2,(-h+c)/2),o(h/2-c/2,(+h-c)/2),o(0,h-c),o(-h/2+c/2,(+h-c)/2),o(-h/2+c/2,(-h+c)/2),o(0,0)],this.segmentSizes=[o(h,c),o(c,h),o(c,h),o(h,c),o(c,h),o(c,h),o(h,c)],this.segmentImages=[n["segment1.svg"],n["segment2.svg"],n["segment2.svg"],n["segment1.svg"],n["segment2.svg"],n["segment2.svg"],n["segment1.svg"]],this.segmentOnImages=[n["segment3.svg"],n["segment4.svg"],n["segment4.svg"],n["segment3.svg"],n["segment4.svg"],n["segment4.svg"],n["segment3.svg"]]}draw(){super.draw(),this.localSpace();var t=this.context.getRenderer();t.rect(0,0,this.transform.size.x,this.transform.size.y,this.getCol(),this.getBorderColor());for(var e=0;e<7;e++){var s=this.segmentPositions[e],i=this.segmentSizes[e],r=this.inputs[e].isOn?this.segmentOnImages[e]:this.segmentImages[e];t.image(r,s.x,s.y,i.x,i.y,void 0)}t.restore()}getDisplayName(){return"7 Segment Display"}getXMLName(){return"sevensegmentdisplay"}}r.getXMLName=function(){return"sevensegmentdisplay"},e.exports=r;var o=t("../../../libraries/math/Vector").V,n=t("../../../libraries/Images")},{"../../../libraries/Images":33,"../../../libraries/math/Vector":51,"../../IOObject":54}],80:[function(t,e,s){var i=t("../../../libraries/Constants").DEFAULT_SIZE,r=t("../../IOObject");class o extends r{constructor(t,e,s,r){super(t,e,s,i,i,a["led.svg"],!1,1,0),this.transform.setPos(n(this.transform.pos.x,this.transform.pos.y-2*this.transform.size.y)),this.color=void 0==r?"#ffffff":r,this.connectorWidth=5,this.setInputAmount(1),this.inputs[0].setOrigin(n(0,0)),this.inputs[0].setTarget(n(0,2*this.transform.size.y)),this.inputs[0].lineColor="#ffffff",this.inputs[0].dir=n(0,1)}updateCullTransform(){super.updateCullTransform(),this.isOn&&(this.cullTransform.setSize(n(3*this.transform.size.x,4*this.transform.size.y)),this.cullTransform.setPos(this.transform.pos.add(n(0,(this.inputs[0].target.y-3*this.transform.size.y/2)/2))))}activate(t,e){super.activate(t,e),this.updateCullTransform()}getImageTint(){return this.color}draw(){super.draw();var t=this.context.getRenderer();this.localSpace(),this.isOn&&t.image(a["ledLight.svg"],0,0,3*this.transform.size.x,3*this.transform.size.y,this.color),t.restore()}getDisplayName(){return"LED"}copy(){var t=super.copy();return t.color=this.color,t.connectorWidth=this.connectorWidth,t}writeTo(t){var e=super.writeTo(t);return l(e,"color",this.color),e}load(t){super.load(t);var e=h(c(t,"color"));return this.color=e,this}}o.getXMLName=function(){return"led"},e.exports=o;var n=t("../../../libraries/math/Vector").V,a=t("../../../libraries/Images"),h=t("../../../libraries/ImportUtils").getStringValue,c=t("../../../libraries/ImportUtils").getChildNode,l=t("../../../controllers/Exporter").createTextElement},{"../../../controllers/Exporter":1,"../../../libraries/Constants":29,"../../../libraries/Images":33,"../../../libraries/ImportUtils":34,"../../../libraries/math/Vector":51,"../../IOObject":54}],81:[function(t,e,s){var i=t("../libraries/Constants").PROPAGATION_TIME,r=t("../libraries/Constants").GRID_SIZE;e.exports=class{constructor(t,e,s){this.renderer=new l(this,t,e,s),this.camera=new n(this),this.history=new a,this.wires=[],this.objects=[],this.updateRequests=0,this.propagationQueue=[],window.addEventListener("resize",t=>this.resize(),!1),this.resize()}reset(){for(var t=0;t<this.objects.length;t++)this.objects[t].remove();for(t=0;t<this.wires.length;t++)this.wires[t].remove();this.objects=[],this.wires=[],this.propagationQueue=[]}propogate(t,e,s){this.propagationQueue.push(new h(this,t,e,s,()=>this.update(t,e)))}update(t,e){for(var s=[];this.propagationQueue.length>0;)s.push(this.propagationQueue.pop());for(;s.length>0;)s.pop().send();this.propagationQueue.length>0&&this.updateRequests++,this.updateRequests--,console.log("update");var r=!1;if(t instanceof c||e instanceof c){for(var o=0;o<this.wires.length;o++)if(this.wires[o]===t||this.wires[o]===e){r=!0;break}}else u();r&&u(),this.updateRequests>0&&setTimeout(()=>this.update(t,e),i)}render(){this.renderer.clear();var t=r/this.camera.zoom,e=o(this.camera.pos.x/this.camera.zoom-this.renderer.canvas.width/2,this.camera.pos.y/this.camera.zoom-this.renderer.canvas.height/2),s=e.x-Math.floor(e.x/t)*t;s<0&&(s+=t);var i=e.y-Math.floor(e.y/t)*t;i<0&&(i+=t),this.renderer.save(),this.renderer.setStyles(void 0,"#999",1/this.camera.zoom),this.renderer.context.beginPath();for(var n=-s;n<=this.renderer.canvas.width-s+t;n+=t)this.renderer._line(n,0,n,this.renderer.canvas.height);for(var a=-i;a<=this.renderer.canvas.height-i+t;a+=t)this.renderer._line(0,a,this.renderer.canvas.width,a);this.renderer.context.closePath(),this.renderer.context.stroke(),this.renderer.restore();for(var h=0;h<this.wires.length;h++)this.camera.cull(this.wires[h].getCullBox())&&this.wires[h].draw();for(h=0;h<this.objects.length;h++)this.camera.cull(this.objects[h].getCullBox())&&this.objects[h].draw();d().draw(this.renderer)}resize(){this.renderer.resize(),this.camera.resize(),u()}addObject(t){-1===this.getIndexOfObject(t)?this.objects.push(t):console.error("Attempted to add an object that already existed!")}addWire(t){-1===this.getIndexOfWire(t)?this.wires.push(t):console.error("Attempted to add a wire that already existed!")}getRenderer(){return this.renderer}getObjects(){return this.objects}getWires(){return this.wires}getIndexOfObject(t){for(var e=0;e<this.objects.length;e++)if(t===this.objects[e])return e;return-1}getIndexOfWire(t){for(var e=0;e<this.wires.length;e++)if(t===this.wires[e])return e;return-1}};var o=t("../libraries/math/Vector").V,n=t("../libraries/Camera"),a=t("../libraries/HistoryManager"),h=t("../libraries/Propagation"),c=t("../models/Wire"),l=t("./Renderer"),u=t("./Renderer").render,d=t("../controllers/tools/Tool").getCurrent},{"../controllers/tools/Tool":26,"../libraries/Camera":28,"../libraries/Constants":29,"../libraries/HistoryManager":32,"../libraries/Propagation":36,"../libraries/math/Vector":51,"../models/Wire":58,"./Renderer":82}],82:[function(t,e,s){var i=t("../libraries/Utils").GetBrowser();var r,o=t("../libraries/Context").getCurrentContext,n=(r=0,{render:function(){0===r&&requestAnimationFrame(function(){r=0,o().render()}),r++}});e.exports=class{constructor(t,e,s,i){this.parent=t,this.canvas=e,this.tintCanvas=document.createElement("canvas"),this.vw=void 0==s?1:s,this.vh=void 0==i?1:i,this.context=this.canvas.getContext("2d"),this.tintCanvas.width=100,this.tintCanvas.height=100,this.tintContext=this.tintCanvas.getContext("2d")}getCamera(){return this.parent.camera}setCursor(t){this.canvas.style.cursor=t}resize(){this.canvas.width=window.innerWidth*this.vw,this.canvas.height=window.innerHeight*this.vh}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}save(){this.context.save()}restore(){this.context.restore()}translate(t){this.context.translate(t.x,t.y)}scale(t){this.context.scale(t.x,t.y)}rotate(t){this.context.rotate(t)}rect(t,e,s,i,r,o,n,a){this.save(),this.setStyles(r,o,n,a),this.context.beginPath(),this.context.rect(t-s/2,e-i/2,s,i),this.context.fill(),(n>0||void 0==n)&&this.context.stroke(),this.context.closePath(),this.restore()}circle(t,e,s,i,r,o,n){this.save(),this.setStyles(i,r,o,n),this.context.beginPath(),this.context.arc(t,e,s,0,2*Math.PI),void 0!=i&&this.context.fill(),(o>0||void 0==o)&&this.context.stroke(),this.context.closePath(),this.restore()}image(t,e,s,i,r,o){this.context.drawImage(t,e-i/2,s-r/2,i,r),void 0!=o&&this.tintImage(t,e,s,i,r,o)}tintImage(t,e,s,r,o,n){this.tintContext.clearRect(0,0,this.tintCanvas.width,this.tintCanvas.height),this.tintContext.fillStyle=n,this.tintContext.fillRect(0,0,this.tintCanvas.width,this.tintCanvas.height),"Firefox"!==i.name?this.tintContext.globalCompositeOperation="destination-atop":this.tintContext.globalCompositeOperation="source-atop",this.tintContext.drawImage(t,0,0,this.tintCanvas.width,this.tintCanvas.height),this.context.globalAlpha=.5,this.context.drawImage(this.tintCanvas,e-r/2,s-o/2,r,o),this.context.globalAlpha=1}text(t,e,s,i,r,o){this.save(),this.context.font="lighter 15px arial",this.context.fillStyle="#000",this.context.textAlign=o,this.context.textBaseline="middle",this.context.fillText(t,e,s),this.restore()}getTextWidth(t){var e;return this.save(),this.context.font="lighter 15px arial",this.context.fillStyle="#000",this.context.textBaseline="middle",e=this.context.measureText(t).width,this.restore(),e}line(t,e,s,i,r,o){this.save(),this.setStyles(void 0,r,o),this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(s,i),this.context.stroke(),this.context.closePath(),this.restore()}_line(t,e,s,i){this.context.moveTo(t,e),this.context.lineTo(s,i)}curve(t,e,s,i,r,o,n,a,h,c){this.save(),this.setStyles(void 0,h,c),this.context.beginPath(),this.context.moveTo(t,e),this.context.bezierCurveTo(r,o,n,a,s,i),this.context.stroke(),this.context.closePath(),this.restore()}quadCurve(t,e,s,i,r,o,n,a){this.save(),this.setStyles(void 0,n,a),this.context.beginPath(),this.context.moveTo(t,e),this.context.quadraticCurveTo(r,o,s,i),this.context.stroke(),this.context.closePath(),this.restore()}shape(t,e,s,i){this.save(),this.setStyles(e,s,i),this.context.beginPath(),this.context.moveTo(t[0].x,t[0].y);for(var r=1;r<t.length;r++)this.context.lineTo(t[r].x,t[r].y);this.context.lineTo(t[0].x,t[0].y),this.context.fill(),this.context.closePath(),i>0&&this.context.stroke(),this.restore()}setStyles(t,e,s,i){void 0!=i&&i!==this.context.globalAlpha&&(this.context.globalAlpha=i),void 0!=(t=void 0==t?"#ffffff":t)&&t!==this.context.fillStyle&&(this.context.fillStyle=t),void 0!=(e=void 0==e?"#000000":e)&&e!==this.context.strokeStyle&&(this.context.strokeStyle=e),void 0!=(s=void 0==s?2:s)&&s!==this.context.lineWidth&&(this.context.lineWidth=s)}},e.exports.render=n.render},{"../libraries/Context":30,"../libraries/Utils":38}],83:[function(t,e,s){t("../libraries/Utils");var i=t("../libraries/Images"),r=t("../libraries/Context"),o=t("../controllers/ICDesigner"),n=(t("../controllers/selectionpopup/SelectionPopup"),t("../controllers/contextmenu/ContextMenu"),t("../controllers/tools/SelectionTool")),a=t("../controllers/Input"),h=t("../controllers/TransformController"),c=t("../controllers/WireController"),l=t("../controllers/SelectionBox"),u=(t("../models/IOObject"),t("./CircuitDesigner")),d=t("./Renderer").render;function p(){d()}document.body.onload=function(){var t=new u(document.getElementById("canvas"));r.setMainContext(new r(t)),r.setCurrentContext(r.getMainContext()),a.registerContext(r.getMainContext()),o.setup(),a.registerContext(o.context),a.addMouseListener(h),a.addMouseListener(c),a.addMouseListener(l),a.addMouseListener(o),n.activate(),i.load(["constLow.svg","constHigh.svg","buttonUp.svg","buttonDown.svg","switchUp.svg","switchDown.svg","led.svg","ledLight.svg","buffer.svg","and.svg","or.svg","xor.svg","segment1.svg","segment2.svg","segment3.svg","segment4.svg","clock.svg","clockOn.svg","keyboard.svg","base.svg"],0,p)}},{"../controllers/ICDesigner":2,"../controllers/Input":3,"../controllers/SelectionBox":6,"../controllers/TransformController":7,"../controllers/WireController":8,"../controllers/contextmenu/ContextMenu":9,"../controllers/selectionpopup/SelectionPopup":22,"../controllers/tools/SelectionTool":25,"../libraries/Context":30,"../libraries/Images":33,"../libraries/Utils":38,"../models/IOObject":54,"./CircuitDesigner":81,"./Renderer":82}]},{},[83]);